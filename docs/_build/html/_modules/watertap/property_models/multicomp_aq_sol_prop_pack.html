<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>watertap.property_models.multicomp_aq_sol_prop_pack &mdash; WaterTAP 1.2.dev0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=d1d7ad24"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="copyright" title="Copyright" href="../../../copyright.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            WaterTAP
              <img src="../../../_static/NAWI_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.2.dev0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how_to_guides/index.html">How To Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../technical_reference/index.html">Technical Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../background/index.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License Agreement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../copyright.html">Copyright</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">WaterTAP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">watertap.property_models.multicomp_aq_sol_prop_pack</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for watertap.property_models.multicomp_aq_sol_prop_pack</h1><div class="highlight"><pre>
<span></span><span class="c1">#################################################################################</span>
<span class="c1"># WaterTAP Copyright (c) 2020-2024, The Regents of the University of California,</span>
<span class="c1"># through Lawrence Berkeley National Laboratory, Oak Ridge National Laboratory,</span>
<span class="c1"># National Renewable Energy Laboratory, and National Energy Technology</span>
<span class="c1"># Laboratory (subject to receipt of any required approvals from the U.S. Dept.</span>
<span class="c1"># of Energy). All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Please see the files COPYRIGHT.md and LICENSE.md for full copyright and license</span>
<span class="c1"># information, respectively. These files are also available online at the URL</span>
<span class="c1"># &quot;https://github.com/watertap-org/watertap/&quot;</span>
<span class="c1">#################################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This property package computes a multi-component aqueous solution that can</span>
<span class="sd">contain ionic and/or neutral solute species. It supports basic calculation </span>
<span class="sd">of component quantities and some physical, chemical and electrical properties. </span>

<span class="sd">This property package was formerly named the &quot;ion_DSPMDE_prop_pack&quot; and was originally </span>
<span class="sd">designed for use with the Donnan Steric Pore Model with Dielectric Exclusion (DSPMDE) for</span>
<span class="sd">nanofiltration.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># TODO:</span>
<span class="c1">#  -add calc option for Stokes radius from Stokes Einstein</span>
<span class="c1">#  -add viscosity as func of temp and concentration</span>

<span class="c1"># Import Python libraries</span>
<span class="kn">import</span> <span class="nn">idaes.logger</span> <span class="k">as</span> <span class="nn">idaeslog</span>

<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">auto</span>

<span class="c1"># Import Pyomo libraries</span>
<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Constraint</span><span class="p">,</span>
    <span class="n">Expression</span><span class="p">,</span>
    <span class="n">Reals</span><span class="p">,</span>
    <span class="n">NonNegativeReals</span><span class="p">,</span>
    <span class="n">log</span><span class="p">,</span>
    <span class="n">Var</span><span class="p">,</span>
    <span class="n">Param</span><span class="p">,</span>
    <span class="n">Set</span><span class="p">,</span>
    <span class="n">Suffix</span><span class="p">,</span>
    <span class="n">value</span><span class="p">,</span>
    <span class="n">check_optimal_termination</span><span class="p">,</span>
    <span class="n">units</span> <span class="k">as</span> <span class="n">pyunits</span><span class="p">,</span>
    <span class="n">exp</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pyomo.common.config</span> <span class="kn">import</span> <span class="n">ConfigValue</span><span class="p">,</span> <span class="n">In</span><span class="p">,</span> <span class="n">Bool</span>
<span class="kn">from</span> <span class="nn">pyomo.util.calc_var_value</span> <span class="kn">import</span> <span class="n">calculate_variable_from_constraint</span>
<span class="kn">from</span> <span class="nn">pyomo.core.base.units_container</span> <span class="kn">import</span> <span class="n">InconsistentUnitsError</span>

<span class="c1"># Import IDAES cores</span>
<span class="kn">from</span> <span class="nn">idaes.core</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">declare_process_block_class</span><span class="p">,</span>
    <span class="n">MaterialFlowBasis</span><span class="p">,</span>
    <span class="n">PhysicalParameterBlock</span><span class="p">,</span>
    <span class="n">StateBlockData</span><span class="p">,</span>
    <span class="n">StateBlock</span><span class="p">,</span>
    <span class="n">MaterialBalanceType</span><span class="p">,</span>
    <span class="n">EnergyBalanceType</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">idaes.core.base.components</span> <span class="kn">import</span> <span class="n">Solute</span><span class="p">,</span> <span class="n">Solvent</span><span class="p">,</span> <span class="n">Cation</span><span class="p">,</span> <span class="n">Anion</span>
<span class="kn">from</span> <span class="nn">idaes.core.base.phases</span> <span class="kn">import</span> <span class="n">AqueousPhase</span>
<span class="kn">from</span> <span class="nn">idaes.core.util.constants</span> <span class="kn">import</span> <span class="n">Constants</span>
<span class="kn">from</span> <span class="nn">idaes.core.util.initialization</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">fix_state_vars</span><span class="p">,</span>
    <span class="n">revert_state_vars</span><span class="p">,</span>
    <span class="n">solve_indexed_blocks</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">idaes.core.util.misc</span> <span class="kn">import</span> <span class="n">add_object_reference</span>
<span class="kn">from</span> <span class="nn">watertap.core.solvers</span> <span class="kn">import</span> <span class="n">get_solver</span>
<span class="kn">from</span> <span class="nn">idaes.core.util.model_statistics</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">degrees_of_freedom</span><span class="p">,</span>
    <span class="n">number_unfixed_variables</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">idaes.core.util.exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ConfigurationError</span><span class="p">,</span>
    <span class="n">InitializationError</span><span class="p">,</span>
    <span class="n">PropertyPackageError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">idaes.core.util.scaling</span> <span class="k">as</span> <span class="nn">iscale</span>
<span class="kn">from</span> <span class="nn">watertap.core.util.scaling</span> <span class="kn">import</span> <span class="n">transform_property_constraints</span>
<span class="kn">from</span> <span class="nn">watertap.core.util.chemistry</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_charge</span><span class="p">,</span>
    <span class="n">get_molar_mass_quantity</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Adam Atia, Xiangyu Bi, Hunter Barber, Kurban Sitterley&quot;</span>
<span class="c1"># Set up logger</span>
<span class="n">_log</span> <span class="o">=</span> <span class="n">idaeslog</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="ActivityCoefficientModel"><a class="viewcode-back" href="../../../apidoc/watertap.property_models.html#watertap.property_models.multicomp_aq_sol_prop_pack.ActivityCoefficientModel">[docs]</a><span class="k">class</span> <span class="nc">ActivityCoefficientModel</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">ideal</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Ideal</span>
    <span class="n">davies</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># Davies</span></div>


<div class="viewcode-block" id="DensityCalculation"><a class="viewcode-back" href="../../../apidoc/watertap.property_models.html#watertap.property_models.multicomp_aq_sol_prop_pack.DensityCalculation">[docs]</a><span class="k">class</span> <span class="nc">DensityCalculation</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">constant</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># constant @ 1000 kg/m3</span>
    <span class="n">seawater</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>  <span class="c1"># seawater correlation for TDS from Sharqawy</span></div>
    <span class="c1"># TODO: add laliberte mixing correlation and/or ideal aqueous solution rule</span>


<div class="viewcode-block" id="DiffusivityCalculation"><a class="viewcode-back" href="../../../apidoc/watertap.property_models.html#watertap.property_models.multicomp_aq_sol_prop_pack.DiffusivityCalculation">[docs]</a><span class="k">class</span> <span class="nc">DiffusivityCalculation</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">none</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">HaydukLaudie</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span></div>


<div class="viewcode-block" id="ElectricalMobilityCalculation"><a class="viewcode-back" href="../../../apidoc/watertap.property_models.html#watertap.property_models.multicomp_aq_sol_prop_pack.ElectricalMobilityCalculation">[docs]</a><span class="k">class</span> <span class="nc">ElectricalMobilityCalculation</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">none</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">EinsteinRelation</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span></div>


<div class="viewcode-block" id="EquivalentConductivityCalculation"><a class="viewcode-back" href="../../../apidoc/watertap.property_models.html#watertap.property_models.multicomp_aq_sol_prop_pack.EquivalentConductivityCalculation">[docs]</a><span class="k">class</span> <span class="nc">EquivalentConductivityCalculation</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">none</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">ElectricalMobility</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span></div>


<div class="viewcode-block" id="TransportNumberCalculation"><a class="viewcode-back" href="../../../apidoc/watertap.property_models.html#watertap.property_models.multicomp_aq_sol_prop_pack.TransportNumberCalculation">[docs]</a><span class="k">class</span> <span class="nc">TransportNumberCalculation</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">none</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span>
    <span class="n">ElectricalMobility</span> <span class="o">=</span> <span class="n">auto</span><span class="p">()</span></div>


<div class="viewcode-block" id="MCASParameterData"><a class="viewcode-back" href="../../../technical_reference/property_models/mc_aq_sol.html#watertap.property_models.multicomp_aq_sol_prop_pack.MCASParameterData">[docs]</a><span class="nd">@declare_process_block_class</span><span class="p">(</span><span class="s2">&quot;MCASParameterBlock&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MCASParameterData</span><span class="p">(</span><span class="n">PhysicalParameterBlock</span><span class="p">):</span>
    <span class="n">CONFIG</span> <span class="o">=</span> <span class="n">PhysicalParameterBlock</span><span class="o">.</span><span class="n">CONFIG</span><span class="p">()</span>

    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;solute_list&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span>
            <span class="n">domain</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Required argument.List of strings that specify names of solute species.&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;stokes_radius_data&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">domain</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Dict of solute species names (keys) and Stokes radius data (values)&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;diffusivity_data&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">domain</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Dict of solute species names (keys) and bulk ion diffusivity data (values)&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;molar_volume_data&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">domain</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Dict of solute species names and molar volume of aqueous species&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;mw_data&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">domain</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Required argument. Dict of component names (keys)and molecular weight data (values)&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;elec_mobility_data&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">{},</span> <span class="n">domain</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Ion electrical mobility&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;trans_num_data&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">domain</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;transport number of ions in the liquid phase&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;equiv_conductivity_phase_data&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">domain</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Equivalent conductivity of ions in the liquid phase&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;charge&quot;</span><span class="p">,</span> <span class="n">ConfigValue</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">{},</span> <span class="n">domain</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Ion charge&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;ignore_neutral_charge&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">Bool</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Boolean flag to raise ConfigurationError related to neutral charge.&quot;</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;Level of reporting results.</span>
<span class="s2">            **default** - False.</span>
<span class="s2">            **Valid values:** {</span>
<span class="s2">            **False** - raise ConfigurationError when charge value not provided for ALL solutes, including neutral solutes (charge=0),</span>
<span class="s2">            **True** - will not raise ConfigurationError when charge not provided for particular solutes, assuming said solutes are meant to be designated as neutral.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;activity_coefficient_model&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="n">ActivityCoefficientModel</span><span class="o">.</span><span class="n">ideal</span><span class="p">,</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">In</span><span class="p">(</span><span class="n">ActivityCoefficientModel</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Activity coefficient model construction flag&quot;</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">           Options to account for activity coefficient model.</span>

<span class="s2">           **default** - ``ActivityCoefficientModel.ideal``</span>

<span class="s2">       .. csv-table::</span>
<span class="s2">           :header: &quot;Configuration Options&quot;, &quot;Description&quot;</span>

<span class="s2">           &quot;``ActivityCoefficientModel.ideal``&quot;, &quot;Activity coefficients equal to 1 assuming ideal solution&quot;</span>
<span class="s2">           &quot;``ActivityCoefficientModel.davies``&quot;, &quot;Activity coefficients estimated via Davies model&quot;</span>
<span class="s2">       &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;density_calculation&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="n">DensityCalculation</span><span class="o">.</span><span class="n">constant</span><span class="p">,</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">In</span><span class="p">(</span><span class="n">DensityCalculation</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Solution density calculation construction flag&quot;</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">           Options to account for solution density.</span>

<span class="s2">           **default** - ``DensityCalculation.constant``</span>

<span class="s2">       .. csv-table::</span>
<span class="s2">           :header: &quot;Configuration Options&quot;, &quot;Description&quot;</span>

<span class="s2">           &quot;``DensityCalculation.constant``&quot;, &quot;Solution density assumed constant at 1000 kg/m3 by default in dens_mass_const parameter&quot;</span>
<span class="s2">           &quot;``DensityCalculation.seawater``&quot;, &quot;Solution density based on correlation for seawater (TDS)&quot;</span>
<span class="s2">       &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;diffus_calculation&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="n">DiffusivityCalculation</span><span class="o">.</span><span class="n">none</span><span class="p">,</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">In</span><span class="p">(</span><span class="n">DiffusivityCalculation</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Diffusivity calculation flag&quot;</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">           Options to account for ionic or molecular diffusivity.</span>

<span class="s2">           **default** - ``DiffusivityCalculation.none``</span>

<span class="s2">       .. csv-table::</span>
<span class="s2">           :header: &quot;Configuration Options&quot;, &quot;Description&quot;</span>

<span class="s2">           &quot;``DiffusivityCalculation.none``&quot;, &quot;Users provide data via the diffusivity_data configuration&quot;</span>
<span class="s2">           &quot;``DiffusivityCalculation.HaydukLaudie``&quot;, &quot;Allow the nonelectrolyte (neutral) species to get diffusivity from the Hayduk Laudie equation&quot;</span>
<span class="s2">       &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;elec_mobility_calculation&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="n">ElectricalMobilityCalculation</span><span class="o">.</span><span class="n">none</span><span class="p">,</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">In</span><span class="p">(</span><span class="n">ElectricalMobilityCalculation</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Electrical mobility calculation flag&quot;</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">           Options to account for ion electrical mobility.</span>

<span class="s2">           **default** - ``ElectricalMobilityCalculation.none``</span>

<span class="s2">       .. csv-table::</span>
<span class="s2">           :header: &quot;Configuration Options&quot;, &quot;Description&quot;</span>

<span class="s2">           &quot;``ElectricalMobilityCalculation.none``&quot;, &quot;Users provide data via the elec_mobility_data configuration&quot;</span>
<span class="s2">           &quot;``ElectricalMobilityCalculation.EinsteinRelation``&quot;, &quot;Calculate from the diffusivity_data by the Einstein Relation&quot;</span>
<span class="s2">       &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;trans_num_calculation&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="n">TransportNumberCalculation</span><span class="o">.</span><span class="n">ElectricalMobility</span><span class="p">,</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">In</span><span class="p">(</span><span class="n">TransportNumberCalculation</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Ion transport number calculation flag&quot;</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">           Options to account for ion transport number in the solution.</span>

<span class="s2">           **default** - ``TransportNumberCalculation.ElectricalMobility``</span>

<span class="s2">       .. csv-table::</span>
<span class="s2">           :header: &quot;Configuration Options&quot;, &quot;Description&quot;</span>

<span class="s2">           &quot;``TransportNumberCalculation.none``&quot;, &quot;Users provide data via the trans_num_data configuration&quot;</span>
<span class="s2">           &quot;``TransportNumberCalculation.ElectricalMobility``&quot;, &quot;Calculated from the elec_mobility_data&quot;</span>
<span class="s2">       &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;equiv_conductivity_calculation&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="n">EquivalentConductivityCalculation</span><span class="o">.</span><span class="n">ElectricalMobility</span><span class="p">,</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">In</span><span class="p">(</span><span class="n">EquivalentConductivityCalculation</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Ion equivalent conductivity calculation flag&quot;</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">           Options to account for the total equivalent conductivity of the liquid phase (solution).</span>

<span class="s2">           **default** - ``EquivalentConductivityCalculation.none``</span>

<span class="s2">       .. csv-table::</span>
<span class="s2">           :header: &quot;Configuration Options&quot;, &quot;Description&quot;</span>

<span class="s2">           &quot;``EquivalentConductivityCalculation.none``&quot;, &quot;Users provide data via the equiv_conductivity_data configuration&quot;</span>
<span class="s2">           &quot;``EquivalentConductivityCalculation.ElectricalMobility``&quot;, &quot;Calculated from the electrical_mobility_data&quot;</span>
<span class="s2">       &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="n">CONFIG</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span>
        <span class="s2">&quot;material_flow_basis&quot;</span><span class="p">,</span>
        <span class="n">ConfigValue</span><span class="p">(</span>
            <span class="n">default</span><span class="o">=</span><span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">molar</span><span class="p">,</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">In</span><span class="p">(</span><span class="n">MaterialFlowBasis</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Material flow basis&quot;</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">           Material flow basis options.</span>

<span class="s2">           **default** - ``MaterialFlowBasis.molar``</span>

<span class="s2">       .. csv-table::</span>
<span class="s2">           :header: &quot;Configuration Options&quot;, &quot;Description&quot;</span>

<span class="s2">           &quot;``MaterialFlowBasis.molar``&quot;, &quot;molar flowrate as the state variable&quot;</span>
<span class="s2">           &quot;``MaterialFlowBasis.mass``&quot;, &quot;mass flowrate as the state variable&quot;</span>
<span class="s2">           &quot;``MaterialFlowBasis.other``&quot;, &quot;other material flowrate as the state variable&quot;</span>
<span class="s2">       &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

<div class="viewcode-block" id="MCASParameterData.build"><a class="viewcode-back" href="../../../technical_reference/property_models/mc_aq_sol.html#watertap.property_models.multicomp_aq_sol_prop_pack.MCASParameterData.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callable method for Block construction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_state_block_class</span> <span class="o">=</span> <span class="n">MCASStateBlock</span>

        <span class="c1"># phases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Liq</span> <span class="o">=</span> <span class="n">AqueousPhase</span><span class="p">()</span>

        <span class="c1"># list to hold all species (including water)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">component_list</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">dimen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H2O</span> <span class="o">=</span> <span class="n">Solvent</span><span class="p">()</span>

        <span class="c1"># Other component sets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solute_set</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">dimen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># All components except Solvent() (&quot;H2O&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cation_set</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">dimen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Components with charge &gt;0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anion_set</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">dimen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Components with charge &lt;0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neutral_set</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">dimen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Components with charge =0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ion_set</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">dimen</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># All Ion Components (cations + anions)</span>

        <span class="c1"># Check that solute_list was not left empty</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">solute_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">solute_list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                <span class="s2">&quot;The solute_list argument was not provided while instantiating the MCAS property model. Provide a list of solutes to solute_list (as a list of strings).&quot;</span>
            <span class="p">)</span>
        <span class="n">charge_comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">charge</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">charge_comp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">solute_list</span><span class="p">):</span>
            <span class="n">track_comp</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">solute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">solute_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">solute</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">charge_comp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1"># if a solute was not provided any charge data, try grabbing automatically based on solute name</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">charge_comp</span><span class="p">[</span><span class="n">solute</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_charge</span><span class="p">(</span><span class="n">solute</span><span class="p">)</span>
                    <span class="c1"># this overrides exception from helper functions so that we can track which solutes couldn&#39;t be populated with data</span>
                    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                        <span class="n">track_comp</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">solute</span><span class="p">:</span> <span class="n">exc</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">ignore_neutral_charge</span><span class="p">:</span>
                <span class="c1"># if ignore_neutral_charge, we assume the user intended to omit charge data because all solutes are neutral</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># otherwise, we let the user know that there might be a mistake</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">track_comp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Charge data could not be obtained for the following solutes and no data were provided</span><span class="se">\n</span><span class="s2">: </span><span class="si">{</span><span class="n">track_comp</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>

        <span class="c1"># Group components into different sets</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">solute_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="s2">&quot;H2O&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                    <span class="s2">&quot;&#39;H2O&#39;is reserved as the default solvent and cannot be a solute.&quot;</span>
                <span class="p">)</span>
            <span class="c1"># Add valid members of solute_list into IDAES&#39;s Solute() class.</span>
            <span class="c1"># This triggers the addition of j into component_list and solute_set.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">Solute</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">charge_comp</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Run a &quot;del_component&quot; and &quot;add_component&quot; to move ion j from IDAES&#39;s Solute to Cation class.</span>
                    <span class="c1"># Ion j has to be added into Solute to be registered in the component_list and solute_set.</span>
                    <span class="c1"># Reference to idaes.core.base.components.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">del_component</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span>
                        <span class="n">j</span><span class="p">,</span>
                        <span class="n">Cation</span><span class="p">(</span><span class="n">charge</span><span class="o">=</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">_electrolyte</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ion_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># The same comments above apply to anions.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">del_component</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_component</span><span class="p">(</span>
                        <span class="n">j</span><span class="p">,</span>
                        <span class="n">Anion</span><span class="p">(</span><span class="n">charge</span><span class="o">=</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">_electrolyte</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ion_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">neutral_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="n">mw_comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mw_data</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mw_comp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">solute_list</span><span class="p">):</span>
            <span class="n">track_mw</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">solute_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mw_comp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1"># if a solute was not provided any mw data, try grabbing automatically based on solute name</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">mw_comp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_molar_mass_quantity</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="c1"># this overrides exception from helper functions so that we can track which solutes couldn&#39;t be populated with data</span>
                    <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                        <span class="n">track_mw</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="p">:</span> <span class="n">exc</span><span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">track_mw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Molecular weight data could not be obtained for the following solutes and no data were provided</span><span class="se">\n</span><span class="s2">: </span><span class="si">{</span><span class="n">track_mw</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
        <span class="n">track_bad_mw_input</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">solute_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mw_comp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># TODO: setting to 1 should effectively ignore mw in the model for now, but conversions between mass and mole won&#39;t be valid. Need a long-term solution.</span>
                <span class="n">mw_comp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">(</span><span class="n">mw_comp</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="n">track_bad_mw_input</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="p">:</span> <span class="n">mw_comp</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">track_bad_mw_input</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;mw_data&#39; values must either be numeric or None when molecular weight is not applicable. The following inputs should be revised:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">track_bad_mw_input</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># TODO: consider turning parameters into variables for future param estimation</span>
        <span class="n">mw_temp</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;H2O&quot;</span><span class="p">:</span> <span class="mf">18e-3</span><span class="p">}</span>
        <span class="n">mw_temp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mw_comp</span><span class="p">)</span>
        <span class="c1"># molecular weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mw_comp</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">component_list</span><span class="p">,</span>
            <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="n">mw_temp</span><span class="p">,</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Molecular weight&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Stokes radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius_stokes_comp</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solute_set</span><span class="p">,</span>
            <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">stokes_radius_data</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Stokes radius of solute&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molar_volume_phase_comp</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solute_set</span><span class="p">,</span>
            <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">molar_volume_data</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;molar volume of solutes&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># TODO:revisit- assuming ~ 1e-3 Pa*s for pure water</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visc_d_phase</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">Pa</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Fluid viscosity&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Ion charge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charge_comp</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solute_set</span><span class="p">,</span>
            <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="n">charge_comp</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">dimensionless</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Ion charge&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">diffus_calculation</span> <span class="o">==</span> <span class="n">DiffusivityCalculation</span><span class="o">.</span><span class="n">none</span><span class="p">:</span>
            <span class="c1"># TODO: revisit this and revise case where diffusivity_data is empty</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diffus_phase_comp</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">solute_set</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">diffusivity_data</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass diffusivity of solute components&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diffus_phase_comp</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>

        <span class="c1"># Dielectric constant of water</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dielectric_constant</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span>
            <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">80.4</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">80.4</span><span class="p">,</span>  <span class="c1"># todo: make a variable with parameter values for coefficients in the function of temperature</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">dimensionless</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Dielectric constant of water&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debye_huckel_b</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span>
            <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Debye Huckel constant b&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Mass density</span>
        <span class="c1"># For constant density</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_const</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span>
            <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass density used in DensityCalculation.constant&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Parameters for seawater density, eq. 8 in Sharqawy et al. (2010)</span>
        <span class="n">dens_units</span> <span class="o">=</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">t_inv_units</span> <span class="o">=</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">K</span><span class="o">**-</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_param_A1</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">9.999e2</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">dens_units</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass density parameter A1&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_param_A2</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">2.034e-2</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">dens_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass density parameter A2&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_param_A3</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=-</span><span class="mf">6.162e-3</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">dens_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass density parameter A3&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_param_A4</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">2.261e-5</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">dens_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass density parameter A4&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_param_A5</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=-</span><span class="mf">4.657e-8</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">dens_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass density parameter A5&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_param_B1</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">8.020e2</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">dens_units</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass density parameter B1&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_param_B2</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=-</span><span class="mf">2.001</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">dens_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass density parameter B2&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_param_B3</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">1.677e-2</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">dens_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass density parameter B3&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_param_B4</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=-</span><span class="mf">3.060e-5</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">dens_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass density parameter B4&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_param_B5</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=-</span><span class="mf">1.613e-5</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">dens_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass density parameter B5&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># traditional parameters are the only Vars currently on the block and should be fixed</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">component_objects</span><span class="p">(</span><span class="n">Var</span><span class="p">):</span>
            <span class="n">v</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>

        <span class="c1"># ---default scaling---</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_default_scaling</span><span class="p">(</span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_default_scaling</span><span class="p">(</span><span class="s2">&quot;pressure&quot;</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_default_scaling</span><span class="p">(</span><span class="s2">&quot;dens_mass_phase&quot;</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;Liq&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_default_scaling</span><span class="p">(</span><span class="s2">&quot;visc_d_phase&quot;</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;Liq&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_default_scaling</span><span class="p">(</span><span class="s2">&quot;diffus_phase_comp&quot;</span><span class="p">,</span> <span class="mf">1e10</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;Liq&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_default_scaling</span><span class="p">(</span><span class="s2">&quot;visc_k_phase&quot;</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;Liq&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_default_scaling</span><span class="p">(</span><span class="s2">&quot;enth_mass_phase&quot;</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;Liq&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_default_scaling</span><span class="p">(</span><span class="s2">&quot;pressure_sat&quot;</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">)</span></div>

<div class="viewcode-block" id="MCASParameterData.define_metadata"><a class="viewcode-back" href="../../../technical_reference/property_models/mc_aq_sol.html#watertap.property_models.multicomp_aq_sol_prop_pack.MCASParameterData.define_metadata">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">define_metadata</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define properties supported and units.&quot;&quot;&quot;</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">add_properties</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;flow_mol_phase_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_flow_mol_phase_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
                <span class="s2">&quot;pressure&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
                <span class="s2">&quot;flow_mass_phase_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_flow_mass_phase_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;flow_mass_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_flow_mass_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;mass_frac_phase_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_mass_frac_phase_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;dens_mass_phase&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_dens_mass_phase&quot;</span><span class="p">},</span>
                <span class="s2">&quot;flow_vol&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_flow_vol&quot;</span><span class="p">},</span>
                <span class="s2">&quot;flow_vol_phase&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_flow_vol_phase&quot;</span><span class="p">},</span>
                <span class="s2">&quot;conc_mol_phase_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_conc_mol_phase_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;conc_mass_phase_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_conc_mass_phase_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;mole_frac_phase_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_mole_frac_phase_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;molality_phase_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_molality_phase_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;diffus_phase_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_diffus_phase_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;visc_d_phase&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_visc_d_phase&quot;</span><span class="p">},</span>
                <span class="s2">&quot;visc_k_phase&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_visc_k_phase&quot;</span><span class="p">},</span>
                <span class="s2">&quot;pressure_osm_phase&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_pressure_osm_phase&quot;</span><span class="p">},</span>
                <span class="s2">&quot;mw_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_mw_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;act_coeff_phase_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_act_coeff_phase_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;enth_mass_phase&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_enth_mass_phase&quot;</span><span class="p">},</span>
                <span class="s2">&quot;pressure_sat&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_pressure_sat&quot;</span><span class="p">},</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">define_custom_properties</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;flow_equiv_phase_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_flow_equiv_phase_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;charge_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_charge_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;conc_equiv_phase_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_conc_equiv_phase_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;equiv_conductivity_phase&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_equiv_conductivity_phase&quot;</span><span class="p">},</span>
                <span class="s2">&quot;elec_cond_phase&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_elec_cond_phase&quot;</span><span class="p">},</span>
                <span class="s2">&quot;dens_mass_solvent&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_dens_mass_solvent&quot;</span><span class="p">},</span>
                <span class="s2">&quot;dielectric_constant&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_dielectric_constant&quot;</span><span class="p">},</span>
                <span class="s2">&quot;debye_huckel_constant&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_debye_huckel_constant&quot;</span><span class="p">},</span>
                <span class="s2">&quot;enth_flow&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_enth_flow&quot;</span><span class="p">},</span>
                <span class="s2">&quot;ionic_strength_molal&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_ionic_strength_molal&quot;</span><span class="p">},</span>
                <span class="s2">&quot;molar_volume_phase_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_molar_volume_phase_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;radius_stokes_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_radius_stokes_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;elec_mobility_phase_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_elec_mobility_phase_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;trans_num_phase_comp&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_trans_num_phase_comp&quot;</span><span class="p">},</span>
                <span class="s2">&quot;total_hardness&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_total_hardness&quot;</span><span class="p">},</span>
                <span class="s2">&quot;total_dissolved_solids&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;_total_dissolved_solids&quot;</span><span class="p">},</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">add_default_units</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
                <span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="p">,</span>
                <span class="s2">&quot;mass&quot;</span><span class="p">:</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span><span class="p">,</span>
                <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span>
                <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">K</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="_MCASStateBlock"><a class="viewcode-back" href="../../../technical_reference/property_models/mc_aq_sol.html#watertap.property_models.multicomp_aq_sol_prop_pack._MCASStateBlock">[docs]</a><span class="k">class</span> <span class="nc">_MCASStateBlock</span><span class="p">(</span><span class="n">StateBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Class contains methods which should be applied to Property Blocks as a whole, rather</span>
<span class="sd">    than individual elements of indexed Property Blocks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="_MCASStateBlock.initialize"><a class="viewcode-back" href="../../../technical_reference/property_models/mc_aq_sol.html#watertap.property_models.multicomp_aq_sol_prop_pack._MCASStateBlock.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">state_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">state_vars_fixed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">hold_state</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">outlvl</span><span class="o">=</span><span class="n">idaeslog</span><span class="o">.</span><span class="n">NOTSET</span><span class="p">,</span>
        <span class="n">solver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">optarg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization routine for property package.</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            state_args : Dictionary with initial guesses for the state vars</span>
<span class="sd">                         chosen. Note that if this method is triggered through the control</span>
<span class="sd">                         volume, and if initial guesses were not provided at the unit model</span>
<span class="sd">                         level, the control volume passes the inlet values as initial guess.</span>
<span class="sd">                         The keys for the state_args dictionary are:</span>
<span class="sd">                         flow_mol_phase_comp : value to initialize phase component flows;</span>
<span class="sd">                         pressure : value at which to initialize pressure;</span>
<span class="sd">                         temperature : value at which to initialize temperature.</span>
<span class="sd">            outlvl : sets output level of initialization routine (default=idaeslog.NOTSET)</span>
<span class="sd">            optarg : solver options dictionary object (default=None)</span>
<span class="sd">            state_vars_fixed : Flag to denote if state vars have already</span>
<span class="sd">                               been fixed.</span>
<span class="sd">                               - True - states have already been fixed by the control volume</span>
<span class="sd">                               1D. Control volume 0D does not fix the state vars, so will be</span>
<span class="sd">                               False if this state block is used with 0D blocks.</span>
<span class="sd">                               - False - states have not been fixed. The state block will deal</span>
<span class="sd">                               with fixing/unfixing.</span>
<span class="sd">            solver : Solver object to use during initialization. If None</span>
<span class="sd">                     is provided, it will use the default solver for IDAES (default = None)</span>
<span class="sd">            hold_state : flag indicating whether the initialization routine</span>
<span class="sd">                         should unfix any state variables fixed during</span>
<span class="sd">                         initialization (default=False).</span>
<span class="sd">                         - True - state variables are not unfixed, and a dict of returned</span>
<span class="sd">                         containing flags for which states were fixed during initialization.</span>
<span class="sd">                         - False - state variables are unfixed after initialization by calling</span>
<span class="sd">                         the release_state method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            If hold_states is True, returns a dict containing flags for which states were fixed</span>
<span class="sd">            during initialization.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get loggers</span>
        <span class="n">init_log</span> <span class="o">=</span> <span class="n">idaeslog</span><span class="o">.</span><span class="n">getInitLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">outlvl</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;properties&quot;</span><span class="p">)</span>
        <span class="n">solve_log</span> <span class="o">=</span> <span class="n">idaeslog</span><span class="o">.</span><span class="n">getSolveLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">outlvl</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;properties&quot;</span><span class="p">)</span>

        <span class="c1"># Set solver and options</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">get_solver</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">optarg</span><span class="p">)</span>

        <span class="c1"># Fix state variables</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">fix_state_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state_args</span><span class="p">)</span>

        <span class="c1"># initialize vars calculated from state vars</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># Vars indexed by phase and component_list</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">material_flow_basis</span> <span class="o">==</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">molar</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;flow_mass_phase_comp&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                            <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                            <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">material_flow_basis</span> <span class="o">==</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">mass</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;flow_mol_phase_comp&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                            <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                            <span class="o">/</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;mass_frac_phase_comp&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">mass_frac_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span>
                            <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;conc_mass_phase_comp&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">conc_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">dens_mass_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">]</span>
                        <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">mass_frac_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;conc_mol_phase_comp&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">conc_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="o">/</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;mole_frac_phase_comp&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">mole_frac_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span>
                            <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

            <span class="c1"># Vars indexed by solute_set</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;molality_phase_comp&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">molality_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="o">/</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;H2O&quot;</span><span class="p">]</span>
                        <span class="o">/</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="s2">&quot;H2O&quot;</span><span class="p">]</span>
                    <span class="p">)</span>

            <span class="c1"># Vars indexed by ion_set</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;elec_mobility_phase_comp&quot;</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">elec_mobility_calculation</span>
                    <span class="o">==</span> <span class="n">ElectricalMobilityCalculation</span><span class="o">.</span><span class="n">EinsteinRelation</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">elec_mobility_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">diffus_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="o">*</span> <span class="n">Constants</span><span class="o">.</span><span class="n">faraday_constant</span>
                        <span class="o">/</span> <span class="p">(</span><span class="n">Constants</span><span class="o">.</span><span class="n">gas_constant</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;conc_equiv_phase_comp&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">conc_equiv_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;flow_equiv_phase_comp&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flow_equiv_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="p">)</span>
            <span class="c1"># Vars not indexed or indexed only by phase</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;flow_vol_phase&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flow_vol_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                    <span class="nb">sum</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span>
                    <span class="p">)</span>
                    <span class="o">/</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">dens_mass_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;visc_k_phase&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">visc_k_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">visc_d_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">dens_mass_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;ionic_strength_molal&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">ionic_strength_molal</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                    <span class="mf">0.5</span>
                    <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
                        <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">molality_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;pressure_osm_phase&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pressure_osm_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                    <span class="nb">sum</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span>
                    <span class="p">)</span>
                    <span class="o">*</span> <span class="n">Constants</span><span class="o">.</span><span class="n">gas_constant</span>
                    <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">temperature</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;equiv_conductivity_phase&quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">equiv_conductivity_calculation</span>
                <span class="o">==</span> <span class="n">EquivalentConductivityCalculation</span><span class="o">.</span><span class="n">ElectricalMobility</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">equiv_conductivity_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                    <span class="nb">sum</span><span class="p">(</span>
                        <span class="n">Constants</span><span class="o">.</span><span class="n">faraday_constant</span>
                        <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">elec_mobility_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span>
                    <span class="p">)</span>
                    <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span>
                        <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cation_set</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;elec_cond_phase&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">elec_cond_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">equiv_conductivity_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">]</span>
                    <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span>
                        <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cation_set</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;total_hardness&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="s2">&quot;eq_total_hardness&quot;</span><span class="p">):</span>
                    <span class="n">calculate_variable_from_constraint</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">total_hardness</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">eq_total_hardness</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">total_hardness</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;total_dissolved_solids&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="s2">&quot;eq_total_dissolved_solids&quot;</span><span class="p">):</span>
                    <span class="n">calculate_variable_from_constraint</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">total_dissolved_solids</span><span class="p">,</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">eq_total_dissolved_solids</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">total_dissolved_solids</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;enth_mass_phase&quot;</span><span class="p">):</span>
                <span class="n">calculate_variable_from_constraint</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">enth_mass_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">eq_enth_mass_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;pressure_sat&quot;</span><span class="p">):</span>
                <span class="n">calculate_variable_from_constraint</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pressure_sat</span><span class="p">,</span>
                    <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">eq_pressure_sat</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Check when the state vars are fixed already result in dof 0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dof</span> <span class="o">=</span> <span class="n">degrees_of_freedom</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">dof</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InitializationError</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">While initializing </span><span class="si">{sb_name}</span><span class="s2">, the degrees of freedom &quot;</span>
                    <span class="s2">&quot;are </span><span class="si">{dof}</span><span class="s2">, when zero is required. </span><span class="se">\n</span><span class="s2">Initialization assumes &quot;</span>
                    <span class="s2">&quot;that the state variables should be fixed and that no other &quot;</span>
                    <span class="s2">&quot;variables are fixed. </span><span class="se">\n</span><span class="s2">If other properties have a &quot;</span>
                    <span class="s2">&quot;predetermined value, use the calculate_state method &quot;</span>
                    <span class="s2">&quot;before using initialize to determine the values for &quot;</span>
                    <span class="s2">&quot;the state variables and avoid fixing the property variables.&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sb_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dof</span><span class="o">=</span><span class="n">dof</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># ---------------------------------------------------------------------</span>
        <span class="n">skip_solve</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># skip solve if only state variables are present</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">number_unfixed_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">skip_solve</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_solve</span><span class="p">:</span>
            <span class="c1"># Initialize properties</span>
            <span class="k">with</span> <span class="n">idaeslog</span><span class="o">.</span><span class="n">solver_log</span><span class="p">(</span><span class="n">solve_log</span><span class="p">,</span> <span class="n">idaeslog</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span> <span class="k">as</span> <span class="n">slc</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">solve_indexed_blocks</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="p">],</span> <span class="n">tee</span><span class="o">=</span><span class="n">slc</span><span class="o">.</span><span class="n">tee</span><span class="p">)</span>
            <span class="n">init_log</span><span class="o">.</span><span class="n">info_high</span><span class="p">(</span>
                <span class="s2">&quot;Property initialization: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idaeslog</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="c1"># If input block, return flags, else release state</span>
        <span class="k">if</span> <span class="n">state_vars_fixed</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hold_state</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">flags</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">release_state</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">skip_solve</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">check_optimal_termination</span><span class="p">(</span><span class="n">results</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">InitializationError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> failed to initialize successfully. Please &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;check the output logs for more information.&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="_MCASStateBlock.release_state"><a class="viewcode-back" href="../../../technical_reference/property_models/mc_aq_sol.html#watertap.property_models.multicomp_aq_sol_prop_pack._MCASStateBlock.release_state">[docs]</a>    <span class="k">def</span> <span class="nf">release_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">outlvl</span><span class="o">=</span><span class="n">idaeslog</span><span class="o">.</span><span class="n">NOTSET</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to release state variables fixed during initialisation.</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            flags : dict containing information of which state variables</span>
<span class="sd">                    were fixed during initialization, and should now be</span>
<span class="sd">                    unfixed. This dict is returned by initialize if</span>
<span class="sd">                    hold_state=True.</span>
<span class="sd">            outlvl : sets output level of logging</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Unfix state variables</span>
        <span class="n">init_log</span> <span class="o">=</span> <span class="n">idaeslog</span><span class="o">.</span><span class="n">getInitLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">outlvl</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;properties&quot;</span><span class="p">)</span>
        <span class="n">revert_state_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
        <span class="n">init_log</span><span class="o">.</span><span class="n">info_high</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> State Released.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span></div>

<div class="viewcode-block" id="_MCASStateBlock.calculate_state"><a class="viewcode-back" href="../../../technical_reference/property_models/mc_aq_sol.html#watertap.property_models.multicomp_aq_sol_prop_pack._MCASStateBlock.calculate_state">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_state</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">var_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">hold_state</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">outlvl</span><span class="o">=</span><span class="n">idaeslog</span><span class="o">.</span><span class="n">NOTSET</span><span class="p">,</span>
        <span class="n">solver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">optarg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Solves state blocks given a set of variables and their values. These variables can be</span>
<span class="sd">        state variables or properties. This method is typically used before initialization to</span>
<span class="sd">        solve for state variables because non-state variables (i.e. properties) cannot be fixed</span>
<span class="sd">        in initialization routines.</span>

<span class="sd">        Keyword Arguments:</span>
<span class="sd">            var_args : dictionary with variables and their values, they</span>
<span class="sd">                       can be state variables or properties</span>
<span class="sd">                       {(VAR_NAME, INDEX): VALUE}</span>
<span class="sd">            hold_state : flag indicating whether all of the state</span>
<span class="sd">                         variables should be fixed after calculate state.</span>
<span class="sd">                         True - State variables will be fixed.</span>
<span class="sd">                         False - State variables will remain unfixed, unless already fixed.</span>
<span class="sd">            outlvl : idaes logger object that sets output level of solve</span>
<span class="sd">                     call (default=idaeslog.NOTSET)</span>
<span class="sd">            solver : solver name string if None is provided the default</span>
<span class="sd">                     solver for IDAES will be used (default = None)</span>
<span class="sd">            optarg : solver options dictionary object (default={})</span>

<span class="sd">        Returns:</span>
<span class="sd">            results object from state block solve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get logger</span>
        <span class="n">solve_log</span> <span class="o">=</span> <span class="n">idaeslog</span><span class="o">.</span><span class="n">getSolveLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">outlvl</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;properties&quot;</span><span class="p">)</span>

        <span class="c1"># Initialize at current state values (not user provided)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="n">solver</span><span class="p">,</span> <span class="n">optarg</span><span class="o">=</span><span class="n">optarg</span><span class="p">,</span> <span class="n">outlvl</span><span class="o">=</span><span class="n">outlvl</span><span class="p">)</span>

        <span class="c1"># Set solver and options</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">get_solver</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">optarg</span><span class="p">)</span>

        <span class="c1"># Fix variables and check degrees of freedom</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{}</span>
        <span class="p">)</span>  <span class="c1"># dictionary noting which variables were fixed and their previous state</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">sb</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">v_name</span><span class="p">,</span> <span class="n">ind</span><span class="p">),</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">var_args</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">var</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sb</span><span class="p">,</span> <span class="n">v_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;While using the calculate_state method on </span><span class="si">{sb_name}</span><span class="s2">, variable </span><span class="si">{v_name}</span><span class="s2"> &quot;</span>
                        <span class="s2">&quot;was provided as an argument in var_args, but it does not have a scaling &quot;</span>
                        <span class="s2">&quot;factor. This suggests that the calculate_scaling_factor method has not been &quot;</span>
                        <span class="s2">&quot;used or the variable was created on demand after the scaling factors were &quot;</span>
                        <span class="s2">&quot;calculated. It is recommended to touch all relevant variables (i.e. call &quot;</span>
                        <span class="s2">&quot;them or set an initial value) before using the calculate_scaling_factor &quot;</span>
                        <span class="s2">&quot;method.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v_name</span><span class="o">=</span><span class="n">v_name</span><span class="p">,</span> <span class="n">sb_name</span><span class="o">=</span><span class="n">sb</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">var</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">is_fixed</span><span class="p">():</span>
                    <span class="n">flags</span><span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v_name</span><span class="p">,</span> <span class="n">ind</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">value</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span> <span class="o">!=</span> <span class="n">val</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
                            <span class="s2">&quot;While using the calculate_state method on </span><span class="si">{sb_name}</span><span class="s2">, </span><span class="si">{v_name}</span><span class="s2"> was &quot;</span>
                            <span class="s2">&quot;fixed to a value </span><span class="si">{val}</span><span class="s2">, but it was already fixed to value </span><span class="si">{val_2}</span><span class="s2">. &quot;</span>
                            <span class="s2">&quot;Unfix the variable before calling the calculate_state &quot;</span>
                            <span class="s2">&quot;method or update var_args.&quot;</span>
                            <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">sb_name</span><span class="o">=</span><span class="n">sb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                <span class="n">v_name</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">,</span>
                                <span class="n">val_2</span><span class="o">=</span><span class="n">value</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flags</span><span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v_name</span><span class="p">,</span> <span class="n">ind</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">var</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">degrees_of_freedom</span><span class="p">(</span><span class="n">sb</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;While using the calculate_state method on </span><span class="si">{sb_name}</span><span class="s2">, the degrees &quot;</span>
                    <span class="s2">&quot;of freedom were </span><span class="si">{dof}</span><span class="s2">, but 0 is required. Check var_args and ensure &quot;</span>
                    <span class="s2">&quot;the correct fixed variables are provided.&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sb_name</span><span class="o">=</span><span class="n">sb</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dof</span><span class="o">=</span><span class="n">degrees_of_freedom</span><span class="p">(</span><span class="n">sb</span><span class="p">))</span>
                <span class="p">)</span>

        <span class="c1"># Solve</span>
        <span class="k">with</span> <span class="n">idaeslog</span><span class="o">.</span><span class="n">solver_log</span><span class="p">(</span><span class="n">solve_log</span><span class="p">,</span> <span class="n">idaeslog</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span> <span class="k">as</span> <span class="n">slc</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">solve_indexed_blocks</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="p">],</span> <span class="n">tee</span><span class="o">=</span><span class="n">slc</span><span class="o">.</span><span class="n">tee</span><span class="p">)</span>
            <span class="n">solve_log</span><span class="o">.</span><span class="n">info_high</span><span class="p">(</span>
                <span class="s2">&quot;Calculate state: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idaeslog</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_optimal_termination</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;While using the calculate_state method on </span><span class="si">{sb_name}</span><span class="s2">, the solver failed &quot;</span>
                <span class="s2">&quot;to converge to an optimal solution. This suggests that the user provided &quot;</span>
                <span class="s2">&quot;infeasible inputs, or that the model is poorly scaled, poorly initialized, &quot;</span>
                <span class="s2">&quot;or degenerate.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># unfix all variables fixed with var_args</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v_name</span><span class="p">,</span> <span class="n">ind</span><span class="p">),</span> <span class="n">previously_fixed</span> <span class="ow">in</span> <span class="n">flags</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">previously_fixed</span><span class="p">:</span>
                <span class="n">var</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">v_name</span><span class="p">)</span>
                <span class="n">var</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">unfix</span><span class="p">()</span>

        <span class="c1"># fix state variables if hold_state</span>
        <span class="k">if</span> <span class="n">hold_state</span><span class="p">:</span>
            <span class="n">fix_state_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span></div></div>


<div class="viewcode-block" id="MCASStateBlockData"><a class="viewcode-back" href="../../../technical_reference/property_models/mc_aq_sol.html#watertap.property_models.multicomp_aq_sol_prop_pack.MCASStateBlockData">[docs]</a><span class="nd">@declare_process_block_class</span><span class="p">(</span><span class="s2">&quot;MCASStateBlock&quot;</span><span class="p">,</span> <span class="n">block_class</span><span class="o">=</span><span class="n">_MCASStateBlock</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MCASStateBlockData</span><span class="p">(</span><span class="n">StateBlockData</span><span class="p">):</span>
<div class="viewcode-block" id="MCASStateBlockData.build"><a class="viewcode-back" href="../../../technical_reference/property_models/mc_aq_sol.html#watertap.property_models.multicomp_aq_sol_prop_pack.MCASStateBlockData.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Callable method for Block construction.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scaling_factor</span> <span class="o">=</span> <span class="n">Suffix</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="n">Suffix</span><span class="o">.</span><span class="n">EXPORT</span><span class="p">)</span>

        <span class="c1"># Add state variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">298.15</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">273.15</span><span class="p">,</span> <span class="mf">373.15</span><span class="p">),</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">K</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;State temperature&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mi">101325</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e5</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">Pa</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;State pressure&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># Property Methods</span>
    <span class="c1"># Material flow state variables generated via on-demand props</span>
    <span class="k">def</span> <span class="nf">_flow_mol_phase_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Component molar flow rate&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">material_flow_basis</span> <span class="o">==</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">mass</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">rule_flow_mol_phase_comp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="n">b</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">eq_flow_mol_phase_comp</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">,</span>
                <span class="n">rule</span><span class="o">=</span><span class="n">rule_flow_mol_phase_comp</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_flow_mass_phase_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Component Mass flowrate&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">material_flow_basis</span> <span class="o">==</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">molar</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">rule_flow_mass_phase_comp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="n">b</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">eq_flow_mass_phase_comp</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">,</span>
                <span class="n">rule</span><span class="o">=</span><span class="n">rule_flow_mass_phase_comp</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_flow_mass_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">add_object_reference</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="s2">&quot;flow_mass_comp&quot;</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="n">j</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span>
            <span class="p">},</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mass_frac_phase_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mass_frac_phase_comp</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.001</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass fraction&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_mass_frac_phase_comp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">mass_frac_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_mass_frac_phase_comp</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">,</span>
            <span class="n">rule</span><span class="o">=</span><span class="n">rule_mass_frac_phase_comp</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dens_mass_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_phase</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">],</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">1e3</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">5e2</span><span class="p">,</span> <span class="mf">2e3</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**-</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass density&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># TODO: reconsider this approach for solution density based on arbitrary solute_list</span>
        <span class="k">def</span> <span class="nf">rule_dens_mass_phase</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">density_calculation</span> <span class="o">==</span> <span class="n">DensityCalculation</span><span class="o">.</span><span class="n">constant</span><span class="p">:</span>
                <span class="n">add_object_reference</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;dens_mass_const&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dens_mass_const</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">dens_mass_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_const</span>
            <span class="k">elif</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">density_calculation</span> <span class="o">==</span> <span class="n">DensityCalculation</span><span class="o">.</span><span class="n">seawater</span><span class="p">:</span>
                <span class="c1"># density, eq. 8 in Sharqawy #TODO- add Sharqawy reference</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">temperature</span> <span class="o">-</span> <span class="mf">273.15</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">K</span>
                <span class="n">s</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">mass_frac_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span><span class="p">)</span>
                <span class="n">dens_mass</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">b</span><span class="o">.</span><span class="n">dens_mass_solvent</span>
                    <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dens_mass_param_B1</span> <span class="o">*</span> <span class="n">s</span>
                    <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dens_mass_param_B2</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="n">t</span>
                    <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dens_mass_param_B3</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span>
                    <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dens_mass_param_B4</span> <span class="o">*</span> <span class="n">s</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span>
                    <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dens_mass_param_B5</span> <span class="o">*</span> <span class="n">s</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">dens_mass_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">==</span> <span class="n">dens_mass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_dens_mass_phase</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">([</span><span class="s2">&quot;Liq&quot;</span><span class="p">],</span> <span class="n">rule</span><span class="o">=</span><span class="n">rule_dens_mass_phase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dens_mass_solvent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_solvent</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">1e3</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**-</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass density of pure water&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_dens_mass_solvent</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>  <span class="c1"># density, eq. 8 in Sharqawy</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">temperature</span> <span class="o">-</span> <span class="mf">273.15</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">K</span>
            <span class="n">dens_mass_w</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dens_mass_param_A1</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dens_mass_param_A2</span> <span class="o">*</span> <span class="n">t</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dens_mass_param_A3</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dens_mass_param_A4</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dens_mass_param_A5</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">4</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">dens_mass_solvent</span> <span class="o">==</span> <span class="n">dens_mass_w</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_dens_mass_solvent</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">rule_dens_mass_solvent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_flow_vol_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow_vol_phase</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Volumetric flow rate&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_flow_vol_phase</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">flow_vol_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
                <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="n">b</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="n">b</span><span class="o">.</span><span class="n">dens_mass_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_flow_vol_phase</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">rule_flow_vol_phase</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_flow_vol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">rule_flow_vol</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">flow_vol_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">flow_vol</span> <span class="o">=</span> <span class="n">Expression</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">rule_flow_vol</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_conc_mol_phase_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**-</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Molar concentration&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_conc_mol_phase_comp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">conc_mass_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_conc_mol_phase_comp</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">,</span>
            <span class="n">rule</span><span class="o">=</span><span class="n">rule_conc_mol_phase_comp</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_conc_mass_phase_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conc_mass_phase_comp</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2e3</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**-</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass concentration&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_conc_mass_phase_comp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">conc_mass_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">dens_mass_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">mass_frac_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_conc_mass_phase_comp</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">,</span>
            <span class="n">rule</span><span class="o">=</span><span class="n">rule_conc_mass_phase_comp</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_flow_equiv_phase_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow_equiv_phase_comp</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Component equivalent charge flowrate&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_flow_equiv_phase_comp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">flow_equiv_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_flow_equiv_phase_comp</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span><span class="p">,</span>
            <span class="n">rule</span><span class="o">=</span><span class="n">rule_flow_equiv_phase_comp</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_conc_equiv_phase_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conc_equiv_phase_comp</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Equivalent charge concentration&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_conc_equiv_phase_comp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">conc_equiv_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_conc_equiv_phase_comp</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span><span class="p">,</span>
            <span class="n">rule</span><span class="o">=</span><span class="n">rule_conc_equiv_phase_comp</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mole_frac_phase_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mole_frac_phase_comp</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.001</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">dimensionless</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mole fraction&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_mole_frac_phase_comp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">mole_frac_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_mole_frac_phase_comp</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">,</span>
            <span class="n">rule</span><span class="o">=</span><span class="n">rule_mole_frac_phase_comp</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_molality_phase_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molality_phase_comp</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mole</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Molality&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_molality_phase_comp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">molality_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="o">/</span> <span class="n">b</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="s2">&quot;H2O&quot;</span><span class="p">]</span>
                <span class="o">/</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="s2">&quot;H2O&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_molality_phase_comp</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span><span class="p">,</span>
            <span class="n">rule</span><span class="o">=</span><span class="n">rule_molality_phase_comp</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_visc_k_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visc_k_phase</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">],</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">9e-7</span><span class="p">,</span> <span class="mf">5e-2</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Kinematic Viscosity&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_visc_k_phase</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">visc_d_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">visc_k_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">dens_mass_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_visc_k_phase</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">([</span><span class="s2">&quot;Liq&quot;</span><span class="p">],</span> <span class="n">rule</span><span class="o">=</span><span class="n">rule_visc_k_phase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_radius_stokes_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">add_object_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;radius_stokes_comp&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">radius_stokes_comp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_molar_volume_phase_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">add_object_reference</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;molar_volume_phase_comp&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">molar_volume_phase_comp</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_diffus_phase_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Retrieve component string names from diffusivity_data configuration</span>
        <span class="n">diffus_data_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">diffusivity_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="c1"># Retrieve component string names from molar_volume_data configuration</span>
        <span class="n">molar_volume_data_indices</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">molar_volume_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">missing_diffus_ind</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">i</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">molar_volume_data_indices</span> <span class="o">|</span> <span class="n">diffus_data_indices</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">diffus_calculation</span> <span class="o">==</span> <span class="n">DiffusivityCalculation</span><span class="o">.</span><span class="n">HaydukLaudie</span><span class="p">:</span>
            <span class="c1"># warning for components with neither diffusivity_data nor molar_volume_data entry</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">missing_diffus_ind</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Neither diffusivity_data nor molar_volume_data was provided for </span><span class="si">{</span><span class="n">missing_diffus_ind</span><span class="si">}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;there will be no diffus_phase_comp properties for these components.&quot;</span>
                <span class="p">)</span>
            <span class="n">common_ind</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">molar_volume_data_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">diffus_data_indices</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">common_ind</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="c1"># warning for components whose diffusivity_data will be overwritten by the HaydukLaudie method.</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Both diffusivity_data and molar_volume_data were provided for </span><span class="si">{</span><span class="n">common_ind</span><span class="si">}</span><span class="s2">; &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;since the the HaydukLaudie method was selected, the diffus_phase_comp property of these components will &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;be calculated based on their molar_volume_data and overwritten.&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diffus_phase_comp</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
                <span class="n">molar_volume_data_indices</span> <span class="o">|</span> <span class="n">diffus_data_indices</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">s</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Mass diffusivity of solute components&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hl_diffus_cont</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span>
                <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="mf">13.26e-9</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">13.26e-9</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">dimensionless</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Hayduk Laudie correlation constant&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hl_visc_coeff</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span>
                <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="mf">1.14</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">1.14</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">dimensionless</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Hayduk Laudie viscosity coefficient&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hl_molar_volume_coeff</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span>
                <span class="n">mutable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">default</span><span class="o">=</span><span class="mf">0.589</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">0.589</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">dimensionless</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Hayduk Laudie molar volume coefficient&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">def</span> <span class="nf">rule_diffus_phase_comp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">diffus_calculation</span>
                    <span class="o">==</span> <span class="n">DiffusivityCalculation</span><span class="o">.</span><span class="n">HaydukLaudie</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">molar_volume_data_indices</span><span class="p">:</span>
                        <span class="n">b</span><span class="o">.</span><span class="n">diffus_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">diffusivity_data</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="k">return</span> <span class="n">Constraint</span><span class="o">.</span><span class="n">Skip</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">diffus_coeff_inv_units</span> <span class="o">=</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">s</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**-</span><span class="mi">2</span>
                        <span class="n">visc_solvent_inv_units</span> <span class="o">=</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">cP</span><span class="o">**-</span><span class="mi">1</span>
                        <span class="n">molar_volume_inv_units</span> <span class="o">=</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">cm</span><span class="o">**-</span><span class="mi">3</span>
                        <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">diffus_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">diffus_coeff_inv_units</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="p">(</span>
                                <span class="n">pyunits</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">visc_d_phase</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">to_units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">cP</span><span class="p">)</span>
                                <span class="o">*</span> <span class="n">visc_solvent_inv_units</span>
                            <span class="p">)</span>
                            <span class="o">**</span> <span class="n">b</span><span class="o">.</span><span class="n">hl_visc_coeff</span>
                        <span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="p">(</span>
                                <span class="n">pyunits</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                                    <span class="n">b</span><span class="o">.</span><span class="n">molar_volume_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
                                    <span class="n">to_units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">cm</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span>
                                <span class="p">)</span>
                                <span class="o">*</span> <span class="n">molar_volume_inv_units</span>
                            <span class="p">)</span>
                            <span class="o">**</span> <span class="n">b</span><span class="o">.</span><span class="n">hl_molar_volume_coeff</span>
                        <span class="p">)</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">hl_diffus_cont</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">eq_diffus_phase_comp</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
                <span class="n">molar_volume_data_indices</span> <span class="o">|</span> <span class="n">diffus_data_indices</span><span class="p">,</span>
                <span class="n">rule</span><span class="o">=</span><span class="n">rule_diffus_phase_comp</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">diffus_calculation</span> <span class="o">==</span> <span class="n">DiffusivityCalculation</span><span class="o">.</span><span class="n">none</span><span class="p">:</span>
            <span class="c1"># warning for components with no diffusivity_data entry</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">missing_diffus_ind</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Diffusivity data was not provided for </span><span class="si">{</span><span class="n">missing_diffus_ind</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="p">)</span>

            <span class="n">add_object_reference</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;diffus_phase_comp&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">diffus_phase_comp</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_visc_d_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">add_object_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;visc_d_phase&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">visc_d_phase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mw_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">add_object_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mw_comp&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_elec_mobility_phase_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elec_mobility_phase_comp</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">5.19e-8</span><span class="p">,</span>  <span class="c1"># default as Na+</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">meter</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">volt</span><span class="o">**-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">second</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Ion electrical mobility&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_elec_mobility_phase_comp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">elec_mobility_calculation</span>
                <span class="o">==</span> <span class="n">ElectricalMobilityCalculation</span><span class="o">.</span><span class="n">none</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">elec_mobility_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
<span class="w">                        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">                        Missing the &quot;elec_mobility_data&quot; configuration to build the elec_mobility_phase_comp </span>
<span class="sd">                        and/or its derived variables for {} in {}. </span>
<span class="sd">                        Provide this configuration or use ElectricalMobilityCalculation.EinsteinRelation.</span>
<span class="sd">                        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">(</span>
                        <span class="n">b</span><span class="o">.</span><span class="n">elec_mobility_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">elec_mobility_data</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">meter</span><span class="o">**</span><span class="mi">2</span>
                        <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">volt</span><span class="o">**-</span><span class="mi">1</span>
                        <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">second</span><span class="o">**-</span><span class="mi">1</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">diffusivity_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
<span class="w">                        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                        Missing a valid diffusivity_data configuration to use EinsteinRelation </span>
<span class="sd">                        to compute the &quot;elec_mobility_phase_comp&quot; for {} in {} . </span>
<span class="sd">                        Provide this configuration or </span>
<span class="sd">                        use another &quot;elec_mobility_calculation&quot; configuration value. &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">elec_mobility_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span class="w">                            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                            The provided elec_mobility_data of {} will be overwritten </span>
<span class="sd">                            by the calculated data for {} because the EinsteinRelation </span>
<span class="sd">                            method is selected.&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

                    <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">elec_mobility_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">diffus_phase_comp</span><span class="p">[</span>
                        <span class="n">p</span><span class="p">,</span> <span class="n">j</span>
                    <span class="p">]</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">Constants</span><span class="o">.</span><span class="n">faraday_constant</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="n">Constants</span><span class="o">.</span><span class="n">gas_constant</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">temperature</span>
                    <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_elec_mobility_phase_comp</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span><span class="p">,</span>
            <span class="n">rule</span><span class="o">=</span><span class="n">rule_elec_mobility_phase_comp</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_charge_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">add_object_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;charge_comp&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dielectric_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">add_object_reference</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;dielectric_constant&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dielectric_constant</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_act_coeff_phase_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">act_coeff_phase_comp</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">dimensionless</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;activity coefficient of component&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_act_coeff_phase_comp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">activity_coefficient_model</span>
                <span class="o">==</span> <span class="n">ActivityCoefficientModel</span><span class="o">.</span><span class="n">ideal</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">act_coeff_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">activity_coefficient_model</span>
                <span class="o">==</span> <span class="n">ActivityCoefficientModel</span><span class="o">.</span><span class="n">davies</span>
            <span class="p">):</span>
                <span class="n">I</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">ionic_strength_molal</span>
                <span class="k">return</span> <span class="n">log</span><span class="p">(</span>
                    <span class="n">b</span><span class="o">.</span><span class="n">act_coeff_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="n">b</span><span class="o">.</span><span class="n">debye_huckel_constant</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">I</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">mole</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">I</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="o">-</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">debye_huckel_b</span> <span class="o">*</span> <span class="n">I</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_act_coeff_phase_comp</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span><span class="p">,</span>
            <span class="n">rule</span><span class="o">=</span><span class="n">rule_act_coeff_phase_comp</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># TODO: note- assuming molal ionic strength goes into Debye Huckel relationship;</span>
    <span class="c1"># the MIT&#39;s DSPMDE paper indicates usage of molar concentration</span>
    <span class="k">def</span> <span class="nf">_ionic_strength_molal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ionic_strength_molal</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Molal ionic strength&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_ionic_strength_molal</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">ionic_strength_molal</span> <span class="o">==</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">molality_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_ionic_strength_molal</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">rule_ionic_strength_molal</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_debye_huckel_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debye_huckel_constant</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">dimensionless</span><span class="p">,</span>
            <span class="c1"># TODO: units are technically (kg/mol)**0.5, but Debye Huckel equation</span>
            <span class="c1">#  is empirical and units don&#39;t seem to cancel as typical. leaving as dimensionless for now</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Temperature-dependent Debye Huckel constant A&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_debye_huckel_constant</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">debye_huckel_constant</span>
                <span class="o">==</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Constants</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">Constants</span><span class="o">.</span><span class="n">avogadro_number</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
                <span class="o">*</span> <span class="p">(</span>
                    <span class="n">Constants</span><span class="o">.</span><span class="n">elemental_charge</span><span class="o">**</span><span class="mi">2</span>
                    <span class="o">/</span> <span class="p">(</span>
                        <span class="mi">4</span>
                        <span class="o">*</span> <span class="n">Constants</span><span class="o">.</span><span class="n">pi</span>
                        <span class="o">*</span> <span class="n">Constants</span><span class="o">.</span><span class="n">vacuum_electric_permittivity</span>
                        <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">dielectric_constant</span>
                        <span class="o">*</span> <span class="n">Constants</span><span class="o">.</span><span class="n">boltzmann_constant</span>
                        <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">temperature</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="o">**</span> <span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="o">*</span> <span class="p">(</span>
                    <span class="n">pyunits</span><span class="o">.</span><span class="n">coulomb</span><span class="o">**</span><span class="mi">3</span>
                    <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mf">1.5</span>
                    <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">farad</span><span class="o">**</span><span class="mf">1.5</span>
                    <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">J</span><span class="o">**</span><span class="mf">1.5</span>
                    <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="o">**</span><span class="mf">0.5</span>
                <span class="p">)</span>
                <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_debye_huckel_constant</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">rule_debye_huckel_constant</span><span class="p">)</span>

    <span class="c1"># TODO: change osmotic pressure calc</span>
    <span class="k">def</span> <span class="nf">_pressure_osm_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pressure_osm_phase</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">Pa</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;van&#39;t Hoff Osmotic pressure&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_pressure_osm_phase</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">pressure_osm_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
                <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span><span class="p">)</span>
                <span class="o">*</span> <span class="n">Constants</span><span class="o">.</span><span class="n">gas_constant</span>
                <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">temperature</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_pressure_osm_phase</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">rule_pressure_osm_phase</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_trans_num_phase_comp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trans_num_phase_comp</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">dimensionless</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Ion transport number in the liquid phase&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_trans_num_phase_comp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">trans_num_calculation</span>
                <span class="o">==</span> <span class="n">TransportNumberCalculation</span><span class="o">.</span><span class="n">none</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">trans_num_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
<span class="w">                        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">                        Missing a valid trans_num_data configuration to build &quot;trans_num_phase_comp&quot; for {} in {}.  </span>
<span class="sd">                        Provide this configuration or use another &quot;trans_num_calculation&quot;</span>
<span class="sd">                        configuration value to contruct the demanded variable(s))&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">(</span>
                        <span class="n">b</span><span class="o">.</span><span class="n">trans_num_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">trans_num_data</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">trans_num_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span class="w">                        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                        The provided trans_num_data of {} will be overritten by the calculated data for {}</span>
<span class="sd">                        because &quot;TransportNumberCalculation&quot; is set as &quot;ElectricalMobility&quot;.&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">trans_num_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="nb">abs</span><span class="p">(</span>
                    <span class="n">b</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="p">)</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">elec_mobility_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span>
                    <span class="n">p</span><span class="p">,</span> <span class="n">j</span>
                <span class="p">]</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">elec_mobility_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_trans_num_phase_comp</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span><span class="p">,</span>
            <span class="n">rule</span><span class="o">=</span><span class="n">rule_trans_num_phase_comp</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_equiv_conductivity_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equiv_conductivity_phase</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">meter</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">ohm</span><span class="o">**-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Total equivalent electrical conducitivty of the liquid phase&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_equiv_conductivity_phase</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">equiv_conductivity_calculation</span>
                <span class="o">==</span> <span class="n">EquivalentConductivityCalculation</span><span class="o">.</span><span class="n">none</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">equiv_conductivity_phase_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span>
<span class="w">                        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">                        Missing a valid equiv_conductivity_phase_data configuration to build </span>
<span class="sd">                        &quot;equiv_conductivity_phase&quot; and its derived variables for {}. </span>
<span class="sd">                        Provide this configuration or use another &quot;equiv_conductivity_calculation&quot;</span>
<span class="sd">                        configuration value to contruct the demanded variable(s))&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span class="w">                            </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">                            Caution should be taken to use a constant solution equivalent conductivity for a multi-electrolyte system.</span>
<span class="sd">                            Heterogeneous concentration variation among ions may lead to varying equivalent conductivity and computing</span>
<span class="sd">                            the phase equivalent conductivity using the &quot;EquivalentConductivityCalculation.ElectricalMobility&quot; method </span>
<span class="sd">                            is recommended.&quot;&quot;&quot;</span>
                        <span class="p">)</span>
                    <span class="k">return</span> <span class="p">(</span>
                        <span class="n">b</span><span class="o">.</span><span class="n">equiv_conductivity_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
                        <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">equiv_conductivity_phase_data</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
                        <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">meter</span><span class="o">**</span><span class="mi">2</span>
                        <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">ohm</span><span class="o">**-</span><span class="mi">1</span>
                        <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span><span class="o">**-</span><span class="mi">1</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">equiv_conductivity_phase_data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<span class="w">                        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                        The provided equiv_conductivity_phase_data will be overritten by the calculated data for {} because</span>
<span class="sd">                        &quot;EquivalentConductivityCalculation&quot; is set as &quot;ElectricalMobility&quot;.&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">equiv_conductivity_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="n">Constants</span><span class="o">.</span><span class="n">faraday_constant</span>
                    <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">elec_mobility_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span>
                <span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cation_set</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_equiv_conductivity_phase</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">rule_equiv_conductivity_phase</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_elec_cond_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elec_cond_phase</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">ohm</span><span class="o">**-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">meter</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Electrical conductivity&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">def</span> <span class="nf">rule_elec_cond_phase</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">elec_cond_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">equiv_conductivity_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cation_set</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_elec_cond_phase</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">rule_elec_cond_phase</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_total_hardness</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_hardness</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">L</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;total hardness as CaCO3&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># add try/except to handle case without multivalent cations,</span>
        <span class="c1"># which would return 0 and result in Inconsitentunits error due to conversion of dimensionless to mg/L</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">total_hardness_temp</span> <span class="o">=</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                <span class="nb">sum</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_vol_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">]</span>
                    <span class="o">*</span> <span class="mf">100.0869</span>
                    <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">g</span>
                    <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">mol</span>
                    <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                    <span class="o">/</span> <span class="mf">2.0</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cation_set</span>
                    <span class="k">if</span> <span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span>
                <span class="p">),</span>
                <span class="n">to_units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">L</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">def</span> <span class="nf">rule_total_hardness</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">total_hardness</span> <span class="o">==</span> <span class="n">total_hardness_temp</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">eq_total_hardness</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">rule_total_hardness</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">InconsistentUnitsError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_hardness</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Since no multivalent cations were specified in solute_list, total_hardness need not be created. total_hardness has been fixed to 0.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_total_dissolved_solids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_dissolved_solids</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">L</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;total dissolved solids&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># add try/except to handle case without ions,</span>
        <span class="c1"># which would return 0 and result in Inconsitentunits error due to conversion of dimensionless to mg/L</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">total_dissolved_solids_temp</span> <span class="o">=</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conc_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span><span class="p">),</span>
                <span class="n">to_units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">mg</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">L</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">def</span> <span class="nf">rule_total_dissolved_solids</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">total_dissolved_solids</span> <span class="o">==</span> <span class="n">total_dissolved_solids_temp</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">eq_total_dissolved_solids</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
                <span class="n">rule</span><span class="o">=</span><span class="n">rule_total_dissolved_solids</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">InconsistentUnitsError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_dissolved_solids</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Since no ions were specified in solute_list, total_dissolved_solids has been fixed to 0. The  total_dissolved_solids calculation does not currently account for apparent species (e.g., NaCl).&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_enth_mass_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="s2">&quot;enth_mass_param_A1&quot;</span><span class="p">):</span>
            <span class="c1"># specific enthalpy parameters, 10-120 C, 0-120 g/kg, 0-12 MPa</span>
            <span class="c1"># Table 9 in Nayar et al. (2016)</span>
            <span class="n">enth_mass_units</span> <span class="o">=</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">J</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span>
            <span class="n">P_inv_units</span> <span class="o">=</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">MPa</span><span class="o">**-</span><span class="mi">1</span>
            <span class="n">t_inv_units</span> <span class="o">=</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">K</span><span class="o">**-</span><span class="mi">1</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A1</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">996.7767</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">P_inv_units</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter A1&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A2</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=-</span><span class="mf">3.2406</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">P_inv_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter A2&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A3</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">0.0127</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">P_inv_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter A3&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A4</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=-</span><span class="mf">4.7723e-5</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">P_inv_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter A4&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A5</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=-</span><span class="mf">1.1748</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">P_inv_units</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter A5&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A6</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">0.01169</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">P_inv_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter A6&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A7</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=-</span><span class="mf">2.6185e-5</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">P_inv_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter A7&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A8</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">7.0661e-8</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">P_inv_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter A8&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B1</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=-</span><span class="mf">2.34825e4</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter B1&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B2</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">3.15183e5</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter B2&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B3</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">2.80269e6</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter B3&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B4</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=-</span><span class="mf">1.44606e7</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter B4&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B5</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">7.82607e3</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter B5&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B6</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=-</span><span class="mf">4.41733</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter B6&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B7</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">2.1394e-1</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter B7&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B8</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=-</span><span class="mf">1.99108e4</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter B8&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B9</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">2.77846e4</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter B9&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B10</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">9.72801</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter B10&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_C1</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">141.355</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter C1&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_C2</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">4202.07</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter C2&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_C3</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=-</span><span class="mf">0.535</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter C3&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_C4</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">0.004</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">enth_mass_units</span> <span class="o">*</span> <span class="n">t_inv_units</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy parameter C4&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">component_objects</span><span class="p">(</span><span class="n">Var</span><span class="p">):</span>
                <span class="n">v</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">enth_mass_phase</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">J</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span><span class="o">**-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Specific enthalpy&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Nayar et al. (2016), eq. 25 and 26, 10-120 C, 0-120 g/kg, 0-12 MPa</span>
        <span class="k">def</span> <span class="nf">rule_enth_mass_phase</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="c1"># temperature in degC, but pyunits in K</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">temperature</span> <span class="o">-</span> <span class="mf">273.15</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">K</span>
            <span class="n">S_kg_kg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">pyunits</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                    <span class="n">b</span><span class="o">.</span><span class="n">total_dissolved_solids</span><span class="p">,</span> <span class="n">to_units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="n">b</span><span class="o">.</span><span class="n">dens_mass_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">S_g_kg</span> <span class="o">=</span> <span class="n">S_kg_kg</span> <span class="o">*</span> <span class="mi">1000</span>
            <span class="n">P</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">pressure</span> <span class="o">-</span> <span class="mi">101325</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">Pa</span>
            <span class="n">P_MPa</span> <span class="o">=</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">to_units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">MPa</span><span class="p">)</span>

            <span class="n">h_w</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_C1</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_C2</span> <span class="o">*</span> <span class="n">t</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_C3</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_C4</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span>
            <span class="p">)</span>
            <span class="n">h_sw0</span> <span class="o">=</span> <span class="n">h_w</span> <span class="o">-</span> <span class="n">S_kg_kg</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B1</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B2</span> <span class="o">*</span> <span class="n">S_kg_kg</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B3</span> <span class="o">*</span> <span class="n">S_kg_kg</span><span class="o">**</span><span class="mi">2</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B4</span> <span class="o">*</span> <span class="n">S_kg_kg</span><span class="o">**</span><span class="mi">3</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B5</span> <span class="o">*</span> <span class="n">t</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B6</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B7</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B8</span> <span class="o">*</span> <span class="n">S_kg_kg</span> <span class="o">*</span> <span class="n">t</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B9</span> <span class="o">*</span> <span class="n">S_kg_kg</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_B10</span> <span class="o">*</span> <span class="n">S_kg_kg</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span>
            <span class="p">)</span>
            <span class="n">h_sw</span> <span class="o">=</span> <span class="n">h_sw0</span> <span class="o">+</span> <span class="n">P_MPa</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A1</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A2</span> <span class="o">*</span> <span class="n">t</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A3</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A4</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span>
                <span class="o">+</span> <span class="n">S_g_kg</span>
                <span class="o">*</span> <span class="p">(</span>
                    <span class="o">+</span><span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A5</span>
                    <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A6</span> <span class="o">*</span> <span class="n">t</span>
                    <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A7</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span>
                    <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">enth_mass_param_A8</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">enth_mass_phase</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">==</span> <span class="n">h_sw</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_enth_mass_phase</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">phase_list</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">rule_enth_mass_phase</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_enth_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># enthalpy flow expression for get_enthalpy_flow_terms method</span>

        <span class="k">def</span> <span class="nf">rule_enth_flow</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>  <span class="c1"># enthalpy flow [J/s]</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="nb">sum</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">)</span>
                <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">enth_mass_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">enth_flow</span> <span class="o">=</span> <span class="n">Expression</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">rule_enth_flow</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pressure_sat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="s2">&quot;pressure_sat_param_psatw_A1&quot;</span><span class="p">):</span>
            <span class="n">t_inv_units</span> <span class="o">=</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">K</span><span class="o">**-</span><span class="mi">1</span>
            <span class="n">s_inv_units</span> <span class="o">=</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">g</span>
            <span class="c1"># vapor pressure parameters,  0-180 C, 0-160 g/kg</span>
            <span class="c1"># eq. 5 and 6 in Nayar et al.(2016)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_psatw_A1</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=-</span><span class="mf">5.8002206e3</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">K</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Vapor pressure of pure water parameter A1&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_psatw_A2</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">1.3914993</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">dimensionless</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Vapor pressure of pure water parameter A2&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_psatw_A3</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=-</span><span class="mf">4.8640239e-2</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">t_inv_units</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Vapor pressure of pure water parameter A3&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_psatw_A4</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">4.1764768e-5</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">t_inv_units</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Vapor pressure of pure water parameter A4&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_psatw_A5</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=-</span><span class="mf">1.4452093e-8</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">t_inv_units</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Vapor pressure of pure water parameter A5&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_psatw_A6</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=</span><span class="mf">6.5459673</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">dimensionless</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Vapor pressure of pure water parameter A6&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_B1</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=-</span><span class="mf">4.5818e-4</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">s_inv_units</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Vapor pressure of seawater parameter B1&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_B2</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
                <span class="n">within</span><span class="o">=</span><span class="n">Reals</span><span class="p">,</span>
                <span class="n">initialize</span><span class="o">=-</span><span class="mf">2.0443e-6</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="n">s_inv_units</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Vapor pressure of seawater parameter B2&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">component_objects</span><span class="p">(</span><span class="n">Var</span><span class="p">):</span>
                <span class="n">v</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pressure_sat</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span>
            <span class="n">initialize</span><span class="o">=</span><span class="mf">1e3</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e8</span><span class="p">),</span>
            <span class="n">units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">Pa</span><span class="p">,</span>
            <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Saturation vapor pressure&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Nayar et al.(2016), eq. 5 and 6, 0-180 C, 0-160 g/kg</span>
        <span class="k">def</span> <span class="nf">rule_pressure_sat</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">temperature</span>
            <span class="n">S_kg_kg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">pyunits</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                    <span class="n">b</span><span class="o">.</span><span class="n">total_dissolved_solids</span><span class="p">,</span> <span class="n">to_units</span><span class="o">=</span><span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">m</span><span class="o">**</span><span class="mi">3</span>
                <span class="p">)</span>
                <span class="o">/</span> <span class="n">b</span><span class="o">.</span><span class="n">dens_mass_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">S_g_kg</span> <span class="o">=</span> <span class="n">S_kg_kg</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">g</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">kg</span>
            <span class="n">psatw</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">exp</span><span class="p">(</span>
                    <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_psatw_A1</span> <span class="o">*</span> <span class="n">t</span><span class="o">**-</span><span class="mi">1</span>
                    <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_psatw_A2</span>
                    <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_psatw_A3</span> <span class="o">*</span> <span class="n">t</span>
                    <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_psatw_A4</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span>
                    <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_psatw_A5</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span>
                    <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_psatw_A6</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="o">*</span> <span class="n">pyunits</span><span class="o">.</span><span class="n">Pa</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="n">pressure_sat</span> <span class="o">==</span> <span class="n">psatw</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_B1</span> <span class="o">*</span> <span class="n">S_g_kg</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">pressure_sat_param_B2</span> <span class="o">*</span> <span class="n">S_g_kg</span><span class="o">**</span><span class="mi">2</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eq_pressure_sat</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">rule_pressure_sat</span><span class="p">)</span>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># General Methods</span>
    <span class="c1"># NOTE: For scaling in the control volume to work properly, these methods must</span>
    <span class="c1"># return a pyomo Var or Expression</span>

<div class="viewcode-block" id="MCASStateBlockData.get_material_flow_terms"><a class="viewcode-back" href="../../../technical_reference/property_models/mc_aq_sol.html#watertap.property_models.multicomp_aq_sol_prop_pack.MCASStateBlockData.get_material_flow_terms">[docs]</a>    <span class="k">def</span> <span class="nf">get_material_flow_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create material flow terms for control volume.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">material_flow_basis</span> <span class="o">==</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">molar</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">material_flow_basis</span> <span class="o">==</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">mass</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span></div>

    <span class="c1"># TODO: add enthalpy terms later</span>
    <span class="c1"># def get_enthalpy_flow_terms(self, p):</span>
    <span class="c1">#     &quot;&quot;&quot;Create enthalpy flow terms.&quot;&quot;&quot;</span>
    <span class="c1">#     return self.enth_flow</span>

    <span class="c1"># TODO: make property package compatible with dynamics</span>
    <span class="c1"># def get_material_density_terms(self, p, j):</span>
    <span class="c1">#     &quot;&quot;&quot;Create material density terms.&quot;&quot;&quot;</span>

    <span class="c1"># def get_enthalpy_density_terms(self, p):</span>
    <span class="c1">#     &quot;&quot;&quot;Create enthalpy density terms.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">default_material_balance_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MaterialBalanceType</span><span class="o">.</span><span class="n">componentTotal</span>

    <span class="k">def</span> <span class="nf">default_energy_balance_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">EnergyBalanceType</span><span class="o">.</span><span class="n">none</span>

<div class="viewcode-block" id="MCASStateBlockData.get_material_flow_basis"><a class="viewcode-back" href="../../../technical_reference/property_models/mc_aq_sol.html#watertap.property_models.multicomp_aq_sol_prop_pack.MCASStateBlockData.get_material_flow_basis">[docs]</a>    <span class="k">def</span> <span class="nf">get_material_flow_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">material_flow_basis</span> <span class="o">==</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">molar</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">molar</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">material_flow_basis</span> <span class="o">==</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">mass</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">mass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PropertyPackageError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> MCAS Property Package set to use unsupported material flow basis: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_material_flow_basis</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="MCASStateBlockData.define_state_vars"><a class="viewcode-back" href="../../../technical_reference/property_models/mc_aq_sol.html#watertap.property_models.multicomp_aq_sol_prop_pack.MCASStateBlockData.define_state_vars">[docs]</a>    <span class="k">def</span> <span class="nf">define_state_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define state vars.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">material_flow_basis</span> <span class="o">==</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">molar</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;flow_mol_phase_comp&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">,</span>
                <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span>
                <span class="s2">&quot;pressure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">material_flow_basis</span> <span class="o">==</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">mass</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;flow_mass_phase_comp&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">,</span>
                <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span>
                <span class="s2">&quot;pressure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PropertyPackageError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> MCAS Property Package set to use unsupported material flow basis: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_material_flow_basis</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="MCASStateBlockData.assert_electroneutrality"><a class="viewcode-back" href="../../../technical_reference/property_models/mc_aq_sol.html#watertap.property_models.multicomp_aq_sol_prop_pack.MCASStateBlockData.assert_electroneutrality">[docs]</a>    <span class="k">def</span> <span class="nf">assert_electroneutrality</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tee</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">defined_state</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">adjust_by_ion</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">get_property</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">solve</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TODO: add descriptions of args and what is returned</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">material_flow_basis</span> <span class="o">==</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">molar</span><span class="p">:</span>
            <span class="n">state_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">material_flow_basis</span> <span class="o">==</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">mass</span><span class="p">:</span>
            <span class="n">state_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PropertyPackageError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> MCAS Property Package set to use unsupported material flow basis: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_material_flow_basis</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">tol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-8</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">defined_state</span> <span class="ow">and</span> <span class="n">get_property</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Set defined_state to true if get_property = </span><span class="si">{</span><span class="n">get_property</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">adjust_by_ion</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">adjust_by_ion</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">charge_balance</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span>
                    <span class="n">expr</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span>
                    <span class="p">)</span>
                    <span class="o">==</span> <span class="mi">0</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">neutral_set</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;adjust_by_ion must be set to the name of an ion in the ion_set. Since the charge argument was not provided for any solutes while instantiating the MCAS property model, all solutes in solute_list were considered as neutral solutes without any charge.&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;adjust_by_ion must be set to the name of an ion in the ion_set.&quot;</span>
                    <span class="p">)</span>
        <span class="k">if</span> <span class="n">defined_state</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">state_var</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">is_fixed</span><span class="p">()</span> <span class="ow">and</span> <span class="n">adjust_by_ion</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">state_var</span><span class="p">[</span><span class="s1">&#39;Liq&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s2"> was not fixed. Fix </span><span class="si">{</span><span class="n">state_var</span><span class="si">}</span><span class="s2"> for each solute&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot; to check that electroneutrality is satisfied.&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">adjust_by_ion</span> <span class="o">==</span> <span class="n">j</span> <span class="ow">and</span> <span class="n">state_var</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">is_fixed</span><span class="p">():</span>
                    <span class="n">state_var</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">unfix</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span><span class="p">:</span>
                <span class="c1"># TODO: check if DOF=0 for defined_state=False valid case? Test with defined_state=false</span>
                <span class="k">if</span> <span class="n">state_var</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">is_fixed</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">state_var</span><span class="p">[</span><span class="s1">&#39;Liq&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s2"> was fixed. Either set defined_state=True or unfix &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">state_var</span><span class="si">}</span><span class="s2"> for each solute to check that electroneutrality is satisfied.&quot;</span>
                    <span class="p">)</span>

        <span class="c1"># touch this var since it is required for this method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span>

        <span class="k">if</span> <span class="n">solve</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">adjust_by_ion</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ion_before_adjust</span> <span class="o">=</span> <span class="n">state_var</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">adjust_by_ion</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="n">solve</span> <span class="o">=</span> <span class="n">get_solver</span><span class="p">()</span>
            <span class="n">solve</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">solve</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">check_optimal_termination</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">value</span><span class="p">(</span>
                    <span class="nb">sum</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">adjust_by_ion</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_balance</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;The stateblock failed to solve while computing concentrations to check the charge balance.&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">value</span><span class="p">(</span>
                <span class="nb">sum</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tol</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">adjust_by_ion</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_balance</span>
                <span class="n">ion_adjusted</span> <span class="o">=</span> <span class="n">state_var</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">adjust_by_ion</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                <span class="k">if</span> <span class="n">defined_state</span><span class="p">:</span>
                    <span class="n">state_var</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">adjust_by_ion</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">ion_adjusted</span><span class="p">)</span>
                    <span class="c1"># touch on-demand property desired</span>
                    <span class="k">if</span> <span class="n">get_property</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">get_property</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_property</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">get_property</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">get_property</span><span class="p">:</span>
                                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                                <span class="s2">&quot;get_property must be a string or list/tuple of strings.&quot;</span>
                            <span class="p">)</span>
                        <span class="n">res_with_prop</span> <span class="o">=</span> <span class="n">solve</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_optimal_termination</span><span class="p">(</span><span class="n">res_with_prop</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;The stateblock failed to solve while solving with on-demand property&quot;</span>
                                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">get_property</span><span class="si">}</span><span class="s2">.&quot;</span>
                            <span class="p">)</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">adjust_by_ion</span><span class="si">}</span><span class="s2"> adjusted: </span><span class="si">{</span><span class="n">state_var</span><span class="si">}</span><span class="s2">[&#39;Liq&#39;,</span><span class="si">{</span><span class="n">adjust_by_ion</span><span class="si">}</span><span class="s2">] was adjusted from &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ion_before_adjust</span><span class="si">}</span><span class="s2"> and fixed &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;to </span><span class="si">{</span><span class="n">ion_adjusted</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">adjust_by_ion</span><span class="si">}</span><span class="s2"> was adjusted and the value computed for </span><span class="si">{</span><span class="n">state_var</span><span class="si">}</span><span class="s2">[&#39;Liq&#39;,</span><span class="si">{</span><span class="n">adjust_by_ion</span><span class="si">}</span><span class="s2">]&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot; is </span><span class="si">{</span><span class="n">ion_adjusted</span><span class="si">}</span><span class="s2">.&quot;</span>
                    <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">tee</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2"> Electroneutrality satisfied for </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">. Balance Result = </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Electroneutrality condition violated in </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">. Ion concentrations should be adjusted to bring &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the result of </span><span class="si">{</span><span class="n">val</span><span class="si">:</span><span class="s2">.2E</span><span class="si">}</span><span class="s2"> closer towards 0.&quot;</span>
            <span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------------------------------------</span>
    <span class="c1"># Scaling methods</span>
    <span class="k">def</span> <span class="nf">calculate_scaling_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">calculate_scaling_factors</span><span class="p">()</span>

        <span class="c1"># setting scaling factors for variables</span>

        <span class="c1"># default scaling factors have already been set with</span>
        <span class="c1"># idaes.core.property_base.calculate_scaling_factors()</span>
        <span class="c1"># for the following variables: pressure,</span>
        <span class="c1"># temperature, dens_mass, visc_d_phase, diffus_phase_comp, enth_mass_phase, pressure_sat</span>

        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mw_comp</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># the following variables should have users&#39; input of scaling factors;</span>
        <span class="c1"># missing input triggers a warning</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">material_flow_basis</span> <span class="o">==</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">molar</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                    <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="n">sf</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">warning</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">sf</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;flow_mass_phase_comp&quot;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                        <span class="ow">is</span> <span class="kc">None</span>
                    <span class="p">):</span>
                        <span class="n">sf</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="p">)</span> <span class="o">*</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">sf</span>
                        <span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">material_flow_basis</span> <span class="o">==</span> <span class="n">MaterialFlowBasis</span><span class="o">.</span><span class="n">mass</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                    <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="n">sf</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">warning</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">sf</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;flow_mol_phase_comp&quot;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                        <span class="ow">is</span> <span class="kc">None</span>
                    <span class="p">):</span>
                        <span class="n">sf</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="p">)</span> <span class="o">/</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">sf</span>
                        <span class="p">)</span>

        <span class="c1"># The following variables and parameters have computed scaling factors;</span>
        <span class="c1"># Users do not have to input scaling factors but, if they do, their value</span>
        <span class="c1"># will override.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;flow_equiv_phase_comp&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_equiv_phase_comp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_equiv_phase_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">sf</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_equiv_phase_comp</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">sf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;diffus_phase_comp&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">diffus_phase_comp</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">diffusivity_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">sf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">diffusivity_data</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sf</span> <span class="o">=</span> <span class="mf">1e10</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diffus_phase_comp</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">sf</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;dens_mass_solvent&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_solvent</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_solvent</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;dens_mass_phase&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_phase</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_phase</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="mf">1e-3</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;visc_d_phase&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visc_d_phase</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visc_d_phase</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="mf">1e3</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;visc_k_phase&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">visc_k_phase</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">visc_k_phase</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;mole_frac_phase_comp&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mole_frac_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                    <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="s2">&quot;H2O&quot;</span><span class="p">:</span>
                        <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mole_frac_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="mi">1</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sf</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="p">)</span> <span class="o">/</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;H2O&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mole_frac_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">sf</span>
                        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;mass_frac_phase_comp&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">:</span>
                <span class="n">comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mass_frac_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                    <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="n">comp</span><span class="o">.</span><span class="n">is_solute</span><span class="p">():</span>
                        <span class="n">sf</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="p">)</span> <span class="o">/</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;H2O&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mass_frac_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">sf</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mass_frac_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="mi">1</span>
                        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;conc_mass_phase_comp&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">:</span>
                <span class="n">sf_dens</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conc_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                    <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="s2">&quot;H2O&quot;</span><span class="p">:</span>
                        <span class="c1"># solvents typically have a mass fraction between 0.5-1</span>
                        <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">conc_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">sf_dens</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">conc_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
                            <span class="n">sf_dens</span>
                            <span class="o">*</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">mass_frac_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                            <span class="p">),</span>
                        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;conc_mol_phase_comp&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">component_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                    <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="n">sf</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">conc_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="p">)</span> <span class="o">/</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">sf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;conc_equiv_phase_comp&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conc_equiv_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                    <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="n">sf</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conc_equiv_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">sf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;pressure_osm_phase&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pressure_osm_phase</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sf_gas_constant</span> <span class="o">=</span> <span class="n">value</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">Constants</span><span class="o">.</span><span class="n">gas_constant</span><span class="p">)</span>
                <span class="n">sf_temp</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span>
                <span class="n">sf_conc_mol</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">sum</span><span class="p">(</span>
                        <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                        <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span>
                    <span class="p">)</span>
                <span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">sf</span> <span class="o">=</span> <span class="n">sf_gas_constant</span> <span class="o">*</span> <span class="n">sf_temp</span> <span class="o">*</span> <span class="n">sf_conc_mol</span>
                <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pressure_osm_phase</span><span class="p">,</span> <span class="n">sf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;elec_mobility_phase_comp&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elec_mobility_phase_comp</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">elec_mobility_calculation</span>
                        <span class="o">==</span> <span class="n">ElectricalMobilityCalculation</span><span class="o">.</span><span class="n">EinsteinRelation</span>
                    <span class="p">):</span>
                        <span class="n">sf</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">diffus_phase_comp</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span> <span class="o">/</span> <span class="mi">40</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">elec_mobility_data</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elec_mobility_phase_comp</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">sf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;trans_num_phase_comp&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans_num_phase_comp</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trans_num_phase_comp</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;equiv_conductivity_phase&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">equiv_conductivity_phase</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">equiv_conductivity_calculation</span>
                        <span class="o">==</span> <span class="n">EquivalentConductivityCalculation</span><span class="o">.</span><span class="n">ElectricalMobility</span>
                    <span class="p">):</span>
                        <span class="n">sf</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="mi">1</span>
                            <span class="o">/</span> <span class="mi">96485</span>
                            <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span>
                                <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">elec_mobility_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                                <span class="p">)</span>
                                <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                                <span class="o">*</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                                <span class="p">)</span>
                                <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">ion_set</span>
                            <span class="p">)</span>
                            <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                            <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span>
                                <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                                <span class="p">)</span>
                                <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cation_set</span>
                            <span class="p">)</span>
                            <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">equiv_conductivity_phase_data</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equiv_conductivity_phase</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">sf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;elec_cond_phase&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elec_cond_phase</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elec_cond_phase</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">sf_equiv_cond_phase</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">equiv_conductivity_phase</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">sf_conc_mol_z</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="nb">sum</span><span class="p">(</span>
                            <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">conc_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                            <span class="p">)</span>
                            <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                            <span class="o">*</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">cation_set</span>
                        <span class="p">)</span>
                        <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="p">)</span>
                    <span class="n">sf</span> <span class="o">=</span> <span class="n">sf_equiv_cond_phase</span> <span class="o">*</span> <span class="n">sf_conc_mol_z</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elec_cond_phase</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">sf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;flow_vol_phase&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_vol_phase</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sf</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;H2O&quot;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span>
                    <span class="p">)</span>
                    <span class="o">*</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="s2">&quot;H2O&quot;</span><span class="p">])</span>
                    <span class="o">/</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dens_mass_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">])</span>
                <span class="p">)</span>
                <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_vol_phase</span><span class="p">,</span> <span class="n">sf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;flow_vol&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_vol</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sf</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_vol_phase</span><span class="p">)</span>
                <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_vol</span><span class="p">,</span> <span class="n">sf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;molality_phase_comp&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molality_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                    <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="n">sf</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                        <span class="o">/</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">flow_mol_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;H2O&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="o">/</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mw_comp</span><span class="p">[</span><span class="s2">&quot;H2O&quot;</span><span class="p">])</span>
                    <span class="p">)</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molality_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">sf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;act_coeff_phase_comp&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">act_coeff_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                    <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>
                    <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">act_coeff_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;debye_huckel_constant&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debye_huckel_constant</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debye_huckel_constant</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;ionic_strength_molal&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ionic_strength_molal</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sf</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">sum</span><span class="p">(</span>
                        <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molality_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                        <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="o">*</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charge_comp</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">solute_set</span>
                    <span class="p">)</span>
                    <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
                    <span class="o">*</span> <span class="mi">2</span>
                <span class="p">)</span>
                <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ionic_strength_molal</span><span class="p">,</span> <span class="n">sf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;total_hardness&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_hardness</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_hardness</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sf</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sf</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">/</span> <span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_hardness</span><span class="p">)</span>
                <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_hardness</span><span class="p">,</span> <span class="n">sf</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;total_dissolved_solids&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_dissolved_solids</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_dissolved_solids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">sf</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sf</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_dissolved_solids</span><span class="p">)</span>
                <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_dissolved_solids</span><span class="p">,</span> <span class="n">sf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;enth_flow&quot;</span><span class="p">):</span>
            <span class="n">iscale</span><span class="o">.</span><span class="n">set_scaling_factor</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">enth_flow</span><span class="p">,</span>
                <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow_mass_phase_comp</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">,</span> <span class="s2">&quot;H2O&quot;</span><span class="p">])</span>
                <span class="o">*</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enth_mass_phase</span><span class="p">[</span><span class="s2">&quot;Liq&quot;</span><span class="p">]),</span>
            <span class="p">)</span>

        <span class="c1"># transforming constraints</span>
        <span class="n">transform_property_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;debye_huckel_constant&quot;</span><span class="p">):</span>
            <span class="n">iscale</span><span class="o">.</span><span class="n">constraint_scaling_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_debye_huckel_constant</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;ionic_strength_molal&quot;</span><span class="p">):</span>
            <span class="n">iscale</span><span class="o">.</span><span class="n">constraint_scaling_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_ionic_strength_molal</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;total_hardness&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;eq_total_hardness&quot;</span>
        <span class="p">):</span>
            <span class="n">sf</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_hardness</span><span class="p">)</span>
            <span class="n">iscale</span><span class="o">.</span><span class="n">constraint_scaling_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_total_hardness</span><span class="p">,</span> <span class="n">sf</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_property_constructed</span><span class="p">(</span><span class="s2">&quot;total_dissolved_solids&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;eq_total_dissolved_solids&quot;</span>
        <span class="p">):</span>
            <span class="n">sf</span> <span class="o">=</span> <span class="n">iscale</span><span class="o">.</span><span class="n">get_scaling_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_dissolved_solids</span><span class="p">)</span>
            <span class="n">iscale</span><span class="o">.</span><span class="n">constraint_scaling_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_total_dissolved_solids</span><span class="p">,</span> <span class="n">sf</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;eq_diffus_phase_comp&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eq_diffus_phase_comp</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">iscale</span><span class="o">.</span><span class="n">constraint_scaling_transform</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mf">1e9</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../copyright.html">Copyright</a> 2020-2024, NAWI.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>