<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to Run Differential Parameter Sweep &mdash; WaterTAP 1.3.dev0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=169190e7" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=4e9539be"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"chtml": {"displayAlign": "left", "displayIndent": "2em"}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="next" title="How to use loopTool to explore flowsheets" href="how_to_use_loopTool_to_explore_flowsheets.html" />
    <link rel="prev" title="Monte Carlo testing with the Parameter Sweep" href="how_to_use_parameter_sweep_monte_carlo.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            WaterTAP
              <img src="../_static/NAWI_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.3.dev0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">How To Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="how_to_run_models_in_a_py_script.html">How to run models in a Python script</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_run_zero_order_model.html">How to run a zero-order model</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_use_a_property_model.html">How to use a property model</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_setup_simple_RO.html">How to setup a simple RO model</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_setup_RO_config_options.html">How to use configuration options in the RO model</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_use_MCAS_property_model.html">How to use the multicomponent aqueous solution (MCAS) property model</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_setup_simple_chemistry.html">How to setup simple chemistry</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_use_apparent_and_true_chemical_species.html">How to use apparent and true chemical species</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_use_inherent_reactions.html">How to use inherent reactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_scale_a_model.html">How to scale a model</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_scale_chemical_reactions.html">How to scale chemical reactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_scale_chemical_species.html">How to scale chemical species</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_scale_chemical_process_energy_balance.html">How to scale energy balance for chemical process</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_use_parameter_sweep.html">How to explore a model with parameter sweep</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_use_parameter_sweep_monte_carlo.html">Monte Carlo testing with the Parameter Sweep</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">How to Run Differential Parameter Sweep</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to">How To</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-documentation">Module Documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="how_to_use_loopTool_to_explore_flowsheets.html">How to use loopTool to explore flowsheets</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_use_debugging_solver_wrapper.html">How to use the debugging solver wrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_use_property_test_harness.html">How to use the property test harness</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_use_ui_api.html">Add a flowsheet to the UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_use_unit_test_harness.html">How to use the unit test harness</a></li>
<li class="toctree-l2"><a class="reference internal" href="how_to_contribute_development.html">How to contribute to WaterTAP’s development</a></li>
<li class="toctree-l2"><a class="reference internal" href="notebooks.html">How to run WaterTAP with Jupyter notebooks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../technical_reference/index.html">Technical Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/index.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License Agreement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../copyright.html">Copyright</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WaterTAP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">How To Guides</a></li>
      <li class="breadcrumb-item active">How to Run Differential Parameter Sweep</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/how_to_guides/how_to_run_differential_parameter_sweep.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-to-run-differential-parameter-sweep">
<h1>How to Run Differential Parameter Sweep<a class="headerlink" href="#how-to-run-differential-parameter-sweep" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>This guide explains how to run a differential parameter sweep for conducting, e.g., value of innovation (VOI), analysis.</p>
</section>
<section id="how-to">
<h2>How To<a class="headerlink" href="#how-to" title="Permalink to this heading"></a></h2>
<p>As before, we begin by importing or explicitly programming any functions relating to flowsheet building/specification, simulation, and optimization setup steps.  We will use the same RO with energy recovery flowsheet for this example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># replace this with your own flowsheet module, e.g.</span>
<span class="c1"># import my_flowsheet_module as mfm</span>
<span class="kn">import</span> <span class="nn">watertap.flowsheets.RO_with_energy_recovery.RO_with_energy_recovery</span> <span class="k">as</span> <span class="nn">RO_flowsheet</span>
</pre></div>
</div>
<p>Once this is done, we import the differential parameter sweep tool and sampling classes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">parameter_sweep</span> <span class="kn">import</span> <span class="n">differential_parameter_sweep</span><span class="p">,</span> <span class="n">UniformSample</span><span class="p">,</span> <span class="n">NormalSample</span>
</pre></div>
</div>
<p>We will use the <a class="reference internal" href="how_to_use_parameter_sweep.html#how-to-use-parameter-sweep"><span class="std std-ref">same setup steps as before</span></a> to set up the generating functions for our model, sweep params, and outputs:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build_model</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="c1"># replace these function calls with</span>
    <span class="c1"># those in your own flowsheet module</span>

    <span class="c1"># set up system</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">RO_flowsheet</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="n">RO_flowsheet</span><span class="o">.</span><span class="n">set_operating_conditions</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">RO_flowsheet</span><span class="o">.</span><span class="n">initialize_system</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="c1"># simulate</span>
    <span class="n">RO_flowsheet</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="c1"># set up the model for optimization</span>
    <span class="n">RO_flowsheet</span><span class="o">.</span><span class="n">optimize_set_up</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">m</span>
</pre></div>
</div>
<p>Once the model has been setup, we specify the variables to sample using a dictionary</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build_sweep_params</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">sweep_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">sweep_params</span><span class="p">[</span><span class="s2">&quot;A_comp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">UniformSample</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">RO</span><span class="o">.</span><span class="n">A_comp</span><span class="p">,</span> <span class="mf">4.2e-12</span><span class="p">,</span> <span class="mf">2.1e-11</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
    <span class="n">sweep_params</span><span class="p">[</span><span class="s2">&quot;membrane_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">UniformSample</span><span class="p">(</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">costing</span><span class="o">.</span><span class="n">reverse_osmosis</span><span class="o">.</span><span class="n">membrane_cost</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">num_samples</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">sweep_params</span>
</pre></div>
</div>
<p>where the <code class="docutils literal notranslate"><span class="pre">A_comp</span></code> attribute will be randomly selected from a uniform distribution of values in the range <span class="math notranslate nohighlight">\([4.2e-12, 2.1e-11]\)</span> and <code class="docutils literal notranslate"><span class="pre">membrane_cost</span></code> will be drawn from a uniform distribution between <span class="math notranslate nohighlight">\([30, 10]\)</span>.  For this example, we will extract flowsheet outputs associated with cost, the levelized cost of water (LCOW) and energy consumption (EC), defined via another dictionary.
Next we will construct a specification dictionary to run the differential parameter sweep.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build_diff_sweep_param_specs</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="n">differential_sweep_specs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">differential_sweep_specs</span><span class="p">[</span><span class="s2">&quot;A_comp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;diff_sample_type&quot;</span><span class="p">:</span> <span class="n">NormalSample</span><span class="p">,</span>
        <span class="s2">&quot;std_dev&quot;</span><span class="p">:</span> <span class="mf">0.3e-12</span><span class="p">,</span>
        <span class="s2">&quot;pyomo_object&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">RO</span><span class="o">.</span><span class="n">A_comp</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">differential_sweep_specs</span><span class="p">[</span><span class="s2">&quot;membrane_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;diff_sample_type&quot;</span><span class="p">:</span> <span class="n">UniformSample</span><span class="p">,</span>
        <span class="s2">&quot;diff_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;percentile&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nominal_lb&quot;</span> <span class="p">:</span> <span class="n">sweep_params</span><span class="p">[</span><span class="s2">&quot;membrane_cost&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower_limit</span><span class="p">,</span>
        <span class="s2">&quot;nominal_ub&quot;</span> <span class="p">:</span> <span class="n">sweep_params</span><span class="p">[</span><span class="s2">&quot;membrane_cost&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper_limit</span><span class="p">,</span>
        <span class="s2">&quot;relative_lb&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span>
        <span class="s2">&quot;relative_ub&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span>
        <span class="s2">&quot;pyomo_object&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">costing</span><span class="o">.</span><span class="n">reverse_osmosis</span><span class="o">.</span><span class="n">membrane_cost</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">differential_sweep_specs</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">differential_sweep_specs</span></code> is a specification dictionary that contains details for how to construct the parameter sweep dictionary for differential sweep. This is a nested dictionary where the first level denotes the variable names for which the differential sweep needs to be carried out. The second level denotes various options to be used for each variable. The number of samples for each differential sweep is specified while initializing the <code class="docutils literal notranslate"><span class="pre">DifferentialParameterSweep</span></code> object using the keyword <code class="docutils literal notranslate"><span class="pre">num_diff_samples</span></code>. There are 4 modes of setting up a variable to undergo differential sweep:</p>
<ol class="arabic">
<li><p><code class="docutils literal notranslate"><span class="pre">NormalSample</span></code> : Uses the nominal value as the mean and expects <code class="docutils literal notranslate"><span class="pre">std_dev</span></code> key for the differential sweep sampling. It looks like the following:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">differential_sweep_specs</span><span class="p">[</span><span class="s2">&quot;A_comp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;diff_sample_type&quot;</span><span class="p">:</span> <span class="n">NormalSample</span><span class="p">,</span>
        <span class="s2">&quot;std_dev&quot;</span><span class="p">:</span> <span class="mf">0.3e-12</span><span class="p">,</span>
        <span class="s2">&quot;pyomo_object&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">RO</span><span class="o">.</span><span class="n">A_comp</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>This differential mode is unique to variables that expect normal sampling. <em>All other sampling types expect one of the other 3 differential modes below.</em></p>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">sum</span></code> : Perturbs the nominal value by a certain absolute percentage to create an upper and lower bound for the differential solve. The logic in the code looks as follows:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lower_bound</span> <span class="o">=</span> <span class="n">nominal_val</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">relative_lb</span><span class="p">)</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="n">nominal_val</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">relative_ub</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">product</span></code>: Perturbs the nominal value by a scaling factor to create upper and lower bounds for the differential sweep. It uses the following logic</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lower_bound</span> <span class="o">=</span> <span class="n">nominal_val</span> <span class="o">*</span> <span class="n">relative_lb</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="n">nominal_val</span> <span class="o">*</span> <span class="n">relative_ub</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">percentile</span></code>: Perturbs the nominal value by a percentage of the difference between the nominal upper and lower bound values. The logic is</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">delta_nominal</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">upper_nominal</span> <span class="o">-</span> <span class="n">lower_nominal</span><span class="p">)</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="n">nominal_val</span> <span class="o">+</span> <span class="n">delta_nominal</span> <span class="o">*</span> <span class="n">relative_lb</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="n">nominal_val</span> <span class="o">+</span> <span class="n">delta_nominal</span> <span class="o">*</span> <span class="n">relative_ub</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>An example differential sweep spec dictionary may look like the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">differential_sweep_specs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">differential_sweep_specs</span><span class="p">[</span><span class="s2">&quot;membrane_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;diff_sample_type&quot;</span><span class="p">:</span> <span class="n">UniformSample</span><span class="p">,</span>
        <span class="s2">&quot;diff_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;percentile&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nominal_lb&quot;</span> <span class="p">:</span> <span class="n">sweep_params</span><span class="p">[</span><span class="s2">&quot;membrane_cost&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower_limit</span><span class="p">,</span>
        <span class="s2">&quot;nominal_ub&quot;</span> <span class="p">:</span> <span class="n">sweep_params</span><span class="p">[</span><span class="s2">&quot;membrane_cost&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">upper_limit</span><span class="p">,</span>
        <span class="s2">&quot;relative_lb&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span>
        <span class="s2">&quot;relative_ub&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span>
        <span class="s2">&quot;pyomo_object&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">costing</span><span class="o">.</span><span class="n">reverse_osmosis</span><span class="o">.</span><span class="n">membrane_cost</span><span class="p">,</span>
    <span class="p">}</span>
<span class="n">differential_sweep_specs</span><span class="p">[</span><span class="s2">&quot;px_cost&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;diff_sample_type&quot;</span><span class="p">:</span> <span class="n">LinearSample</span><span class="p">,</span>
    <span class="s2">&quot;diff_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
    <span class="s2">&quot;relative_lb&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="s2">&quot;relative_ub&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="s2">&quot;pyomo_object&quot;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">costing</span><span class="o">.</span><span class="n">pressure_exchanger</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">differential_sweep_specs</span><span class="p">[</span><span class="s2">&quot;px_efficiency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;diff_sample_type&quot;</span><span class="p">:</span> <span class="n">UniformSample</span><span class="p">,</span>
    <span class="s2">&quot;diff_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span>
    <span class="s2">&quot;relative_lb&quot;</span> <span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="s2">&quot;relative_ub&quot;</span> <span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="s2">&quot;pyomo_object&quot;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">PXR</span><span class="o">.</span><span class="n">efficiency_pressure_exchanger</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The user can only conduct differential sweeps for variables specified with <code class="docutils literal notranslate"><span class="pre">sweep_params</span></code>.</p>
</div>
<p>Continuing with the example test code from above, we will use the following function for building the outputs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build_outputs</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sweep_params</span><span class="p">):</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;EC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">costing</span><span class="o">.</span><span class="n">specific_energy_consumption</span>
    <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;LCOW&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fs</span><span class="o">.</span><span class="n">costing</span><span class="o">.</span><span class="n">LCOW</span>
    <span class="k">return</span> <span class="n">outputs</span>
</pre></div>
</div>
<p>With the flowsheet defined and suitably initialized, along with the definitions for <code class="docutils literal notranslate"><span class="pre">sweep_params</span></code>, <code class="docutils literal notranslate"><span class="pre">differential_sweep_specs</span></code>, and <code class="docutils literal notranslate"><span class="pre">outputs</span></code> on hand, we can call the <code class="docutils literal notranslate"><span class="pre">differential_parameter_sweep</span></code> function as before.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This documentation currently uses the older API for calling the differential parameter sweep. This API will be deprecated in the near future. The documentation will be changed to reflect this accordingly. We recommend running the differential parameter sweep in serial or with MPI only.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the local results directory, num_samples, and seed (if desired)</span>
<span class="n">num_samples</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">seed</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">()</span>
<span class="n">sweep_params</span> <span class="o">=</span> <span class="n">build_sweep_params</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="n">num_samples</span><span class="p">)</span>
<span class="n">differential_sweep_specs</span> <span class="o">=</span> <span class="n">build_diff_sweep_param_specs</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">build_outputs</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sweep_params</span><span class="p">)</span>

<span class="c1"># Run the parameter sweep</span>
<span class="n">global_results</span> <span class="o">=</span> <span class="n">differential_parameter_sweep</span><span class="p">(</span>
        <span class="n">build_model</span><span class="p">,</span>
        <span class="n">build_sweep_params</span><span class="p">,</span>
        <span class="n">differential_sweep_specs</span><span class="p">,</span>
        <span class="n">outputs</span><span class="p">,</span>
        <span class="n">h5_results_file_name</span><span class="o">=</span><span class="s1">&#39;monte_carlo_results.h5&#39;</span><span class="p">,</span>
        <span class="n">optimize_function</span><span class="o">=</span><span class="n">RO_flowsheet</span><span class="o">.</span><span class="n">optimize</span><span class="p">,</span>
        <span class="n">debugging_data_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">num_samples</span><span class="o">=</span><span class="n">num_samples</span><span class="p">,</span>
        <span class="n">num_diff_samples</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>...
</pre></div>
</div>
</section>
<section id="module-documentation">
<h2>Module Documentation<a class="headerlink" href="#module-documentation" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://parameter-sweep.readthedocs.io/en/latest/technical_reference/parameter_sweep/index.html#module-parameter_sweep" title="(in Parameter Sweep v0.1.dev5+g518572f)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">parameter_sweep</span></code></a></p></li>
<li><p><a class="reference external" href="https://parameter-sweep.readthedocs.io/en/latest/technical_reference/parameter_sweep/differential/index.html#module-parameter_sweep.differential" title="(in Parameter Sweep v0.1.dev5+g518572f)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">parameter_sweep.differential</span></code></a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="how_to_use_parameter_sweep_monte_carlo.html" class="btn btn-neutral float-left" title="Monte Carlo testing with the Parameter Sweep" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="how_to_use_loopTool_to_explore_flowsheets.html" class="btn btn-neutral float-right" title="How to use loopTool to explore flowsheets" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../copyright.html">Copyright</a> 2020-2024, NAWI.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>